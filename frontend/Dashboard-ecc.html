<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sales-Spy E-commerce Dashboard</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { primary: "#1E3A8A", secondary: "#5BC0EB" },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <style>
      :where([class^="ri-"])::before {
        content: "\f3c2";
      }
      body {
        font-family: "Inter", sans-serif;
        background-color: #f9fafb;
      }
      .glassmorphism {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      input:focus {
        outline: none;
      }
      .sidebar-expanded {
        width: 240px;
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .sidebar-collapsed {
        width: 80px;
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .main-content-expanded {
        margin-left: 240px;
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .main-content-collapsed {
        margin-left: 80px;
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }
      @media (max-width: 768px) {
        .main-content-expanded,
        .main-content-collapsed {
          margin-left: 0;
        }
      }
      .custom-switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
      }
      .custom-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #e2e8f0;
        transition: 0.4s;
        border-radius: 24px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: #3b82f6;
      }
      input:checked + .slider:before {
        transform: translateX(20px);
      }
    </style>
  </head>
  <body>
    <div class="flex h-screen bg-gray-50">
      <!-- Sidebar -->
      <div
        id="sidebar"
        class="sidebar-expanded fixed h-full bg-white shadow-lg z-20 transition-all duration-700 ease-in-out"
      >
        <div class="flex flex-col h-full">
          <!-- Logo -->
          <div class="p-4 border-b flex items-center justify-center relative">
            <img
              src="https://res.cloudinary.com/dtrn8j0sz/image/upload/v1749075914/SS_s4jkfw.jpg"
              alt="Logo"
              id="sidebar-logo-img"
              class="w-8 h-8 mr-0 hidden"
            />
            <h1
              id="sidebar-logo-text"
              class="font-['Pacifico'] text-2xl text-primary"
            >
              Sales-Spy
            </h1>
            <!-- Mobile-only collapse button -->
            <button
              id="sidebar-mobile-close"
              class="absolute right-2 top-2 p-2 rounded-full hover:bg-gray-100 md:hidden"
              aria-label="Close sidebar"
            >
              <i class="ri-close-line text-xl"></i>
            </button>
          </div>

          <!-- Navigation -->
            <nav class="flex-1 overflow-y-auto py-4">
            <ul>
              <li class="mb-2">
              <a
                href="Dashboard-home.html"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-100 rounded-r-lg hover:text-primary transition-colors"
              >
                <div class="w-6 h-6 flex items-center justify-center mr-3">
                <i class="ri-dashboard-line"></i>
                </div>
                <span class="sidebar-text">Dashboard</span>
              </a>
              </li>
              <li class="mb-2">
              <a
                href="Dashboard-com.html"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-100 rounded-r-lg hover:text-primary transition-colors"
              >
                <div class="w-6 h-6 flex items-center justify-center mr-3">
                <i class="ri-global-line"></i>
                </div>
                <span class="sidebar-text">Websites</span>
              </a>
              </li>
              <li class="mb-2">
              <a
                href="Dashboard-ecc.html"
                class="flex items-center px-4 py-3 text-primary bg-blue-50 rounded-r-lg border-l-4 border-primary"
              >
                <div class="w-6 h-6 flex items-center justify-center mr-3">
                <i class="ri-shopping-cart-line"></i>
                </div>
                <span class="sidebar-text">E-commerce</span>
              </a>
              </li>
              
              <li class="mb-2">
              <a
                href="Dashboard-pay.html"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-100 rounded-r-lg hover:text-primary transition-colors"
              >
                <div class="w-6 h-6 flex items-center justify-center mr-3">
                <i class="ri-bank-card-line"></i>
                </div>
                <span class="sidebar-text">Payment</span>
              </a>
              </li>
              <li class="mb-2">
              <a
                href="Dashboard-his.html"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-100 rounded-r-lg hover:text-primary transition-colors"
              >
                <div class="w-6 h-6 flex items-center justify-center mr-3">
                <i class="ri-file-list-3-line"></i>
                </div>
                <span class="sidebar-text">Transaction History</span>
              </a>
              </li>
              <li class="mb-2">
              <a
                href="Dashboard-set.html"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-100 rounded-r-lg hover:text-primary transition-colors"
              >
                <div class="w-6 h-6 flex items-center justify-center mr-3">
                <i class="ri-settings-line"></i>
                </div>
                <span class="sidebar-text">Settings</span>
              </a>
              </li>
            </ul>
            </nav>

          <!-- Upgrade section -->
            <div id="upgrade-section" class="p-4 border-t">
            <div id="upgrade-expanded" class="bg-gray-50 rounded-lg p-4 mb-3">
              <p class="text-sm text-gray-600 mb-2 sidebar-text-mobile">Credits remaining</p>
              <div class="flex items-center justify-between">
              <span class="font-semibold text-lg sidebar-text-mobile">1,250</span>
              <span class="text-xs text-gray-500 sidebar-text-mobile">of 2,000</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
              <div class="bg-primary rounded-full h-2" style="width: 62.5%"></div>
              </div>
            </div>
            <a href="Dashboard-pay.html">
              <button id="upgrade-btn-expanded"
              class="w-full bg-primary text-white py-2 px-4 rounded-button flex items-center justify-center whitespace-nowrap hover:bg-blue-600 transition-colors">
              <div class="w-5 h-5 flex items-center justify-center mr-2">
                <i class="ri-arrow-up-line"></i>
              </div>
              <span class="sidebar-text-mobile">Upgrade Plan</span>
              </button>
            </a>
            <a href="Dashboard-pay.html">
              <button id="upgrade-btn-collapsed"
              class="hidden bg-primary text-white w-10 h-10 rounded-full flex items-center justify-center mx-auto mt-2 hover:bg-blue-600 transition-colors"
              title="Upgrade">
              <i class="ri-arrow-up-line"></i>
              </button>
            </a>
            </div>
            <style>
            @media (max-width: 768px) {
              .sidebar-collapsed .sidebar-text-mobile {
              display: none !important;
              }
            }
            </style>
            <script>
            document.addEventListener("DOMContentLoaded", function () {
              const sidebar = document.getElementById("sidebar");
              const upgradeExpanded =
              document.getElementById("upgrade-expanded");
              const upgradeBtnExpanded = document.getElementById(
              "upgrade-btn-expanded"
              );
              const upgradeBtnCollapsed = document.getElementById(
              "upgrade-btn-collapsed"
              );
              const logoImg = document.getElementById("sidebar-logo-img");
              const logoText = document.getElementById("sidebar-logo-text");
              function updateUpgradeSection() {
              if (sidebar.classList.contains("sidebar-collapsed")) {
                upgradeExpanded.style.display = "none";
                upgradeBtnExpanded.style.display = "none";
                upgradeBtnCollapsed.classList.remove("hidden");
              } else {
                upgradeExpanded.style.display = "";
                upgradeBtnExpanded.style.display = "";
                upgradeBtnCollapsed.classList.add("hidden");
              }
              }
              function updateLogo() {
              if (sidebar.classList.contains("sidebar-collapsed")) {
                logoImg.classList.remove("hidden");
                logoText.classList.add("hidden");
              } else {
                logoImg.classList.add("hidden");
                logoText.classList.remove("hidden");
              }
              }
              updateUpgradeSection();
              updateLogo();
              const sidebarToggle = document.getElementById("sidebar-toggle");
              sidebarToggle.addEventListener("click", function () {
              setTimeout(() => {
                updateUpgradeSection();
                updateLogo();
              }, 310);
              });
              window.addEventListener("resize", function () {
              setTimeout(() => {
                updateUpgradeSection();
                updateLogo();
              }, 310);
              });
            });
            </script>
          <script>
            document.addEventListener("DOMContentLoaded", function () {
              const sidebar = document.getElementById("sidebar");
              const upgradeExpanded =
                document.getElementById("upgrade-expanded");
              const upgradeBtnExpanded = document.getElementById(
                "upgrade-btn-expanded"
              );
              const upgradeBtnCollapsed = document.getElementById(
                "upgrade-btn-collapsed"
              );
              const logoImg = document.getElementById("sidebar-logo-img");
              const logoText = document.getElementById("sidebar-logo-text");

              function updateUpgradeSection() {
                if (sidebar.classList.contains("sidebar-collapsed")) {
                  upgradeExpanded.style.display = "none";
                  upgradeBtnExpanded.style.display = "none";
                  upgradeBtnCollapsed.classList.remove("hidden");
                } else {
                  upgradeExpanded.style.display = "";
                  upgradeBtnExpanded.style.display = "";
                  upgradeBtnCollapsed.classList.add("hidden");
                }
              }

              function updateLogo() {
                if (sidebar.classList.contains("sidebar-collapsed")) {
                  logoImg.classList.remove("hidden");
                  logoText.classList.add("hidden");
                } else {
                  logoImg.classList.add("hidden");
                  logoText.classList.remove("hidden");
                }
              }

              // Initial state
              updateUpgradeSection();
              updateLogo();

              // Listen for sidebar toggle
              const sidebarToggle = document.getElementById("sidebar-toggle");
              sidebarToggle.addEventListener("click", function () {
                setTimeout(() => {
                  updateUpgradeSection();
                  updateLogo();
                }, 310); // Wait for transition
              });

              // Also update on resize (for responsive)
              window.addEventListener("resize", function () {
                setTimeout(() => {
                  updateUpgradeSection();
                  updateLogo();
                }, 310);
              });
            });
          </script>
        </div>
      </div>

      <!-- Main Content -->
      <div
        id="main-content"
        class="main-content-expanded flex-1 transition-all duration-700 ease-in-out overflow-x-auto"
      >
        <!-- Header -->
        <header class="bg-white shadow-sm sticky top-0 z-10">
          <div class="flex items-center justify-between px-6 py-4">
            <div class="flex items-center">
              <button
                id="sidebar-toggle"
                class="p-2 rounded-full hover:bg-gray-100 mr-4"
              >
                <div class="w-5 h-5 flex items-center justify-center">
                  <i class="ri-menu-line"></i>
                </div>
              </button>
            </div>
            <div class="flex items-center space-x-4">
              <div class="flex items-center bg-gray-100 rounded-full px-3 py-1">
                <div
                  class="w-5 h-5 flex items-center justify-center mr-2 text-primary"
                >
                  <i class="ri-coin-line"></i>
                </div>
                <span class="text-sm font-medium">1,250 credits</span>
              </div>
              <a href="Dashboard-pay.html">
                <button
                  class="bg-primary text-white py-2 px-4 rounded-button whitespace-nowrap hover:bg-blue-600 transition-colors"
                >
                  <span>Upgrade</span>
                </button>
              </a>
              <div class="relative">
                <button class="flex items-center space-x-2">
                  <div
                    class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden"
                  >
                    <img
                      src="https://readdy.ai/api/search-image?query=professional%20headshot%20of%20a%20young%20business%20person%2C%20neutral%20expression%2C%20high%20quality%20portrait%2C%20business%20attire&width=200&height=200&seq=1&orientation=squarish"
                      alt="User avatar"
                      class="w-full h-full object-cover"
                    />
                  </div>
                </button>
              </div>
            </div>
          </div>
        </header>

        <!-- Content -->
        <main class="flex-1 p-6">
          <div class="mb-6">
            <h1 class="text-2xl font-bold text-primary mb-2" style="color: #1E3A8A;">E-commerce Intelligence</h1>
            <p class="text-gray-600">
              Discover and analyze <span class="font-bold " style="color: #1E3A8A;">competitor Shopify stores</span> for market intelligence.
            </p>
          </div>
          <!-- Data Source Toggle -->
          <div class="bg-white rounded shadow-sm mb-4">
            <div class="p-4 flex items-center justify-between">
              <div class="flex items-center space-x-4">
                <h2 class="text-lg font-semibold text-gray-800">Data Source</h2>
                <div class="flex items-center space-x-2">
                  <span class="text-sm text-gray-600">Database Data</span>
                  <label class="custom-switch">
                    <input type="checkbox" id="toggleIntelligenceData" />
                    <span class="slider"></span>
                  </label>
                  <span class="text-sm text-gray-600">Live Competitor Data</span>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <button id="autoUpdateBtn" class="bg-green-500 text-white px-4 py-2 rounded-button text-sm hover:bg-green-600 transition-colors">
                  <i class="ri-refresh-line mr-1"></i>
                  Auto Update
                </button>
                <span id="lastUpdated" class="text-xs text-gray-500"></span>
              </div>
            </div>
          </div>
          <!-- Filters Section -->
          <div class="bg-white rounded shadow-sm mb-6">
            <div
              class="p-4 border-b border-gray-100 flex items-center justify-between"
            >
              <h2 class="text-lg font-semibold text-gray-800">Filters</h2>
              <div class="flex items-center">
                <span class="text-sm text-gray-600 mr-2">More Filters</span>
                <!-- Toggle Switch for Advanced Filters -->
                <label class="custom-switch ml-2">
                  <input type="checkbox" id="toggleAdvancedFilters" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
            <div class="p-4">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Keyword</label
                  >
                  <input
                    type="text"
                    class="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                    placeholder="Enter keywords..."
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Platform</label
                  >
                  <select
                    id="platformFilter"
                    class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                  >
                    <option value="">All Platforms</option>
                    <option value="shopify">Shopify</option>
                    <option value="woocommerce">WooCommerce</option>
                    <option value="magento">Magento</option>
                    <option value="wordpress">WordPress</option>
                  </select>
                </div>
                <div id="categoryFilter" class="hidden">
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Category</label
                  >
                  <select
                    id="categorySelect"
                    class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                  >
                    <option value="">All Categories</option>
                    <option value="fashion">Fashion</option>
                    <option value="beauty">Beauty</option>
                    <option value="home">Home</option>
                    <option value="tech">Tech</option>
                    <option value="fitness">Fitness</option>
                    <option value="jewelry">Jewelry</option>
                    <option value="food">Food</option>
                    <option value="electronics">Electronics</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >SNS & Email</label
                  >
                  <select
                    class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                  >
                    <option value="">All</option>
                    <option value="facebook">Facebook</option>
                    <option value="instagram">Instagram</option>
                    <option value="twitter">Twitter</option>
                    <option value="email">Email Available</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Indexed Date</label
                  >
                  <input
                    type="date"
                    class="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                  />
                </div>
              </div>
              <div id="advancedFilters" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Tags</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="">Select Tags</option>
                      <option value="fashion">Fashion</option>
                      <option value="electronics">Electronics</option>
                      <option value="home">Home & Garden</option>
                      <option value="beauty">Beauty</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Language</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="">All Languages</option>
                      <option value="en">English</option>
                      <option value="es">Spanish</option>
                      <option value="fr">French</option>
                      <option value="de">German</option>
                      <option value="zh">Chinese</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Country</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="">All Countries</option>
                      <option value="us">United States</option>
                      <option value="uk">United Kingdom</option>
                      <option value="ca">Canada</option>
                      <option value="au">Australia</option>
                      <option value="de">Germany</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Product Count</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="">Any</option>
                      <option value="1-100">1-100</option>
                      <option value="101-500">101-500</option>
                      <option value="501-1000">501-1000</option>
                      <option value="1001+">1001+</option>
                    </select>
                  </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Pages</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="">Any</option>
                      <option value="1-10">1-10</option>
                      <option value="11-50">11-50</option>
                      <option value="51-100">51-100</option>
                      <option value="101+">101+</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Top Level Domain</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="">All TLDs</option>
                      <option value=".com">.com</option>
                      <option value=".org">.org</option>
                      <option value=".net">.net</option>
                      <option value=".io">.io</option>
                      <option value=".co">.co</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Technologies</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="">All Technologies</option>
                      <option value="react">React</option>
                      <option value="vue">Vue.js</option>
                      <option value="angular">Angular</option>
                      <option value="jquery">jQuery</option>
                      <option value="bootstrap">Bootstrap</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Installed Apps</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="">All Apps</option>
                      <option value="analytics">Google Analytics</option>
                      <option value="hotjar">Hotjar</option>
                      <option value="intercom">Intercom</option>
                      <option value="mailchimp">Mailchimp</option>
                      <option value="zendesk">Zendesk</option>
                    </select>
                  </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Domain Reg Year</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="">Any Year</option>
                      <option value="2023-2025">2023-2025</option>
                      <option value="2020-2022">2020-2022</option>
                      <option value="2015-2019">2015-2019</option>
                      <option value="2010-2014">2010-2014</option>
                      <option value="before-2010">Before 2010</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Product Avg Price</label
                    >
                    <div class="flex space-x-2">
                      <input
                        type="number"
                        placeholder="Min"
                        class="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                      />
                      <input
                        type="number"
                        placeholder="Max"
                        class="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                      />
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Currency</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="">All Currencies</option>
                      <option value="usd">USD</option>
                      <option value="eur">EUR</option>
                      <option value="gbp">GBP</option>
                      <option value="cad">CAD</option>
                      <option value="aud">AUD</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Order Results By</label
                    >
                    <select
                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm custom-select pr-8"
                    >
                      <option value="relevance">Relevance</option>
                      <option value="date-desc">Date (Newest)</option>
                      <option value="date-asc">Date (Oldest)</option>
                      <option value="traffic-desc">
                        Traffic (High to Low)
                      </option>
                      <option value="traffic-asc">Traffic (Low to High)</option>
                      <option value="products-desc">
                        Products (High to Low)
                      </option>
                      <option value="products-asc">
                        Products (Low to High)
                      </option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="flex mt-6">
                <button
                  id="searchBtn"
                  class="bg-primary text-white px-6 py-2 rounded-button flex items-center whitespace-nowrap mr-3"
                >
                  <div class="w-5 h-5 flex items-center justify-center mr-2">
                    <i class="ri-search-line"></i>
                  </div>
                  Search
                </button>
                <button
                  id="resetBtn"
                  class="bg-gray-100 text-gray-700 px-6 py-2 rounded-button whitespace-nowrap"
                >
                  Reset
                </button>
              </div>
            </div>
          </div>
          <!-- Results Section -->
          <div class="bg-white rounded shadow-sm">
            <div
              class="p-4 border-b border-gray-100 flex justify-between items-center"
            >
              <div id="resultsCount" class="text-sm text-gray-600">Loading stores...</div>
              <div class="flex items-center">
                <button
                  class="bg-gray-100 text-gray-700 px-3 py-1.5 rounded-button text-sm whitespace-nowrap mr-3"
                >
                  <div class="flex items-center">
                    <div class="w-4 h-4 flex items-center justify-center mr-1">
                      <i class="ri-download-line"></i>
                    </div>
                    Export
                  </div>
                </button>

                <button
                  id="display-columns-btn"
                  class="bg-gray-100 text-gray-700 px-3 py-1.5 rounded-button text-sm whitespace-nowrap relative focus:outline-none"
                  type="button"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <div class="flex items-center">
                    <div class="w-4 h-4 flex items-center justify-center mr-1">
                      <i class="ri-list-check"></i>
                    </div>
                    Display
                  </div>
                </button>
                <div
                  id="columns-dropdown"
                  class="hidden absolute right-0 mt-2 z-30 w-64 bg-white border border-gray-200 rounded-lg shadow-lg p-3 max-h-80 overflow-y-auto transition-all duration-200"
                  tabindex="-1"
                  aria-label="Column visibility menu"
                >
                  <form id="columns-dropdown-form" class="flex flex-col gap-2">
                    <!-- Checkbox items will be injected here by JS -->
                  </form>
                </div>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Domain
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Platform
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Title
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Description
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Language
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Country
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Product Count
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Collections Count
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Product Avg Price
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Currency
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Email
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Phone
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      WhatsApp
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Fb Ad Count (Past 30 Days)
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Domain Reg Date
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Latest Product Upload Date
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Indexed Date
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Facebook Followers
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Instagram Followers
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Pinterest Followers
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      YouTube Followers
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Facebook Link
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Twitter Link
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Instagram Link
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Pinterest Link
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Tiktok Link
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      YouTube Link
                    </th>
                  </tr>
                </thead>
          <!-- Results Section -->
          <div class="bg-white rounded shadow-sm">
            <div
              class="p-4 border-b border-gray-100 flex justify-between items-center"
            >
              <div id="resultsCount" class="text-sm text-gray-600">Loading stores...</div>
              <div class="flex items-center">
                <button
                  class="bg-gray-100 text-gray-700 px-3 py-1.5 rounded-button text-sm whitespace-nowrap mr-3"
                >
                  <div class="flex items-center">
                    <div class="w-4 h-4 flex items-center justify-center mr-1">
                      <i class="ri-download-line"></i>
                    </div>
                    Export
                  </div>
                </button>
                <button
                  id="display-columns-btn"
                  class="bg-gray-100 text-gray-700 px-3 py-1.5 rounded-button text-sm whitespace-nowrap relative focus:outline-none"
                  type="button"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <div class="flex items-center">
                    <div class="w-4 h-4 flex items-center justify-center mr-1">
                      <i class="ri-list-check"></i>
                    </div>
                    Display
                  </div>
                </button>
              </div>
            </div>
            <div class="overflow-x-auto">
              <div id="results" class="min-h-[400px]">
                <!-- Dynamic competitive intelligence data will be loaded here by JavaScript -->
              </div>
            </div>
            <div id="pagination" class="px-6 py-4 flex items-center justify-between border-t border-gray-200">
              <!-- Pagination will be populated by JavaScript -->
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Keep only the relevant scripts for your dashboard, charts, advanced filters, and column visibility dropdown. Remove duplicate or unused scripts. Place this at the end of your <body> -->

    <script>
      // Sidebar toggle and responsive behavior
      document.addEventListener("DOMContentLoaded", function () {
        const sidebar = document.getElementById("sidebar");
        const mainContent = document.getElementById("main-content");
        const sidebarToggle = document.getElementById("sidebar-toggle");
        const sidebarTexts = document.querySelectorAll(".sidebar-text");
        const sidebarMobileClose = document.getElementById("sidebar-mobile-close");

        function isMobile() {
          return window.innerWidth < 768;
        }

        function openSidebar() {
          sidebar.classList.add("sidebar-expanded");
          sidebar.classList.remove("sidebar-collapsed");
          mainContent.classList.add("main-content-expanded");
          mainContent.classList.remove("main-content-collapsed");
          sidebarTexts.forEach((text) => (text.style.display = ""));
          if (isMobile()) {
            sidebar.style.transform = "translateX(0)";
            if (sidebarMobileClose) sidebarMobileClose.style.display = "";
          }
        }

        function closeSidebar() {
          sidebar.classList.remove("sidebar-expanded");
          sidebar.classList.add("sidebar-collapsed");
          mainContent.classList.remove("main-content-expanded");
          mainContent.classList.add("main-content-collapsed");
          sidebarTexts.forEach((text) => (text.style.display = "none"));
          if (isMobile()) {
            sidebar.style.transform = "translateX(-100%)";
            if (sidebarMobileClose) sidebarMobileClose.style.display = "none";
          }
        }

        function handleResize() {
          if (isMobile()) {
            closeSidebar();
            if (sidebarMobileClose) sidebarMobileClose.style.display = "";
          } else {
            openSidebar();
            if (sidebarMobileClose) sidebarMobileClose.style.display = "none";
          }
        }

        window.addEventListener("DOMContentLoaded", handleResize);
        window.addEventListener("resize", handleResize);

        sidebarToggle.addEventListener("click", function () {
          if (sidebar.classList.contains("sidebar-expanded")) {
            closeSidebar();
          } else {
            openSidebar();
          }
        });

        if (sidebarMobileClose) {
          sidebarMobileClose.addEventListener("click", closeSidebar);
        }
      });
    </script>
    <script>
      // Toggle Advanced Filters functionality
      document.addEventListener("DOMContentLoaded", function () {
        const toggle = document.getElementById("toggleAdvancedFilters");
        const advancedFilters = document.getElementById("advancedFilters");
        if (toggle && advancedFilters) {
          toggle.addEventListener("change", function () {
            if (toggle.checked) {
              advancedFilters.classList.remove("hidden");
            } else {
              advancedFilters.classList.add("hidden");
            }
          });
        }
      });
    </script>

    <script>
      // Column visibility toggle functionality (Display dropdown)
      document.addEventListener("DOMContentLoaded", function () {
        const displayBtn = document.getElementById("display-columns-btn");
        const dropdown = document.getElementById("columns-dropdown");
        const dropdownForm = document.getElementById("columns-dropdown-form");
        const table = document.querySelector("table");
        if (!displayBtn || !dropdown || !dropdownForm || !table) return;

        // Updated columns array: only these checked by default
        // Store = Domain, Platform, Title, Country, Product Count, Product Avg Price
        const columns = [
          { key: "domain", label: "Domain", checked: true },
          { key: "platform", label: "Platform", checked: true },
          { key: "title", label: "Title", checked: true },
          { key: "description", label: "Description", checked: false },
          { key: "language", label: "Language", checked: false },
          { key: "country", label: "Country", checked: true },
          { key: "product-count", label: "Product Count", checked: true },
          {
            key: "collections-count",
            label: "Collections Count",
            checked: false,
          },
          {
            key: "product-avg-price",
            label: "Product Avg Price",
            checked: true,
          },
          { key: "currency", label: "Currency", checked: false },
          { key: "email", label: "Email", checked: false },
          { key: "phone", label: "Phone", checked: false },
          { key: "whatsapp", label: "WhatsApp", checked: false },
          {
            key: "fb-ad-count",
            label: "Fb Ad Count (Past 30 Days)",
            checked: false,
          },
          { key: "domain-reg-date", label: "Domain Reg Date", checked: false },
          {
            key: "latest-product-upload-date",
            label: "Latest Product Upload Date",
            checked: false,
          },
          { key: "indexed-date", label: "Indexed Date", checked: false },
          {
            key: "facebook-followers",
            label: "Facebook Followers",
            checked: false,
          },
          {
            key: "instagram-followers",
            label: "Instagram Followers",
            checked: false,
          },
          {
            key: "pinterest-followers",
            label: "Pinterest Followers",
            checked: false,
          },
          {
            key: "youtube-followers",
            label: "YouTube Followers",
            checked: false,
          },
          { key: "facebook-link", label: "Facebook Link", checked: false },
          { key: "twitter-link", label: "Twitter Link", checked: false },
          { key: "instagram-link", label: "Instagram Link", checked: false },
          { key: "pinterest-link", label: "Pinterest Link", checked: false },
          { key: "tiktok-link", label: "Tiktok Link", checked: false },
          { key: "youtube-link", label: "YouTube Link", checked: false },
        ];

        // Render checkboxes
        dropdownForm.innerHTML = "";
        columns.forEach((col) => {
          const id = `col-toggle-${col.key}`;
          const label = document.createElement("label");
          label.setAttribute("for", id);
          label.className =
            "flex items-center gap-2 cursor-pointer px-1 py-1 rounded hover:bg-gray-50";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = id;
          checkbox.className =
            "column-toggle form-checkbox h-4 w-4 text-primary";
          checkbox.dataset.columnKey = col.key;
          checkbox.checked = col.checked;

          const span = document.createElement("span");
          span.textContent = col.label;
          span.className = "text-sm text-gray-700";

          label.appendChild(checkbox);
          label.appendChild(span);
          dropdownForm.appendChild(label);
        });

        // Map table columns to data-column-key attribute
        function mapTableColumns() {
          const ths = table.querySelectorAll("thead th");
          ths.forEach((th, idx) => {
            const thText = th.textContent.trim().toLowerCase();
            const col = columns.find((c) => c.label.toLowerCase() === thText);
            if (col) th.setAttribute("data-column-key", col.key);
          });
          // For each row, set data-column-key on each td
          table.querySelectorAll("tbody tr").forEach((tr) => {
            tr.querySelectorAll("td").forEach((td, idx) => {
              const th = table.querySelectorAll("thead th")[idx];
              if (th && th.hasAttribute("data-column-key")) {
                td.setAttribute(
                  "data-column-key",
                  th.getAttribute("data-column-key")
                );
              }
            });
          });
        }
        mapTableColumns();

        // Set initial visibility based on checked state
        columns.forEach((col) => {
          setColumnVisibility(col.key, col.checked);
        });

        // Toggle column visibility
        function setColumnVisibility(key, visible) {
          table
            .querySelectorAll(`th[data-column-key="${key}"]`)
            .forEach((th) => {
              th.style.display = visible ? "" : "none";
            });
          table
            .querySelectorAll(`td[data-column-key="${key}"]`)
            .forEach((td) => {
              td.style.display = visible ? "" : "none";
            });
        }

        // Checkbox change handler
        dropdownForm.addEventListener("change", function (e) {
          if (e.target.classList.contains("column-toggle")) {
            const key = e.target.dataset.columnKey;
            setColumnVisibility(key, e.target.checked);
          }
        });

        // Dropdown toggle
        function openDropdown() {
          dropdown.classList.remove("hidden");
          displayBtn.setAttribute("aria-expanded", "true");
          setTimeout(() => dropdown.focus(), 0);
        }
        function closeDropdown() {
          dropdown.classList.add("hidden");
          displayBtn.setAttribute("aria-expanded", "false");
        }
        displayBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          if (dropdown.classList.contains("hidden")) {
            openDropdown();
          } else {
            closeDropdown();
          }
        });

        // Click-away to close
        document.addEventListener("mousedown", function (e) {
          if (!dropdown.contains(e.target) && !displayBtn.contains(e.target)) {
            closeDropdown();
          }
        });
        // Keyboard navigation: ESC to close
        dropdown.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            closeDropdown();
            displayBtn.focus();
          }
        });
      });
    </script>

    <!-- Details Panel (slide in from right, custom content) -->
    <div id="detailsPanel"
       class="fixed top-0 right-0 z-50 h-full w-[750px] max-w-full bg-white shadow-lg transform translate-x-full transition-transform duration-300 overflow-y-auto"
    >
      <!-- Close button at top left -->
      <button id="detailsPanelCloseBtn"
          class="absolute top-4 left-4 z-10 p-2 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-500 hover:text-gray-700 focus:outline-none"
          title="Close panel"
          type="button"
      >
      <i class="ri-close-line text-xl"></i>
      </button>
      <div id="detailsContent" class="p-0">
      <!-- Panel content will be injected here -->
      </div>
    </div>
    <script>
      // Add close button logic for details panel
      document.addEventListener("DOMContentLoaded", function () {
        const detailsPanel = document.getElementById('detailsPanel');
        const closeBtn = document.getElementById('detailsPanelCloseBtn');
        if (detailsPanel && closeBtn) {
          closeBtn.onclick = function () {
            detailsPanel.classList.remove('translate-x-0');
            detailsPanel.classList.add('translate-x-full');
            document.getElementById('detailsContent').innerHTML = '';
          };
        }
      });
    </script>

    <script>
      // --- MOCK DATA SECTION ---
      // In production, replace this with backend/API data fetching.
      // Each domain key maps to a full data object for the detail panel.
      const websiteFullData = {
        "yamloveme.com": {
          domain: "yamloveme.com",
          name: "yamloveme",
          owner: "Jane Smith",
          traffic: "12,500/mo",
          dateAdded: "2023-11-20",
          hosting: "Shopify",
          tags: ["Jewelry", "Trendy", "US"],
          description: "Trendy jewelry and accessories",
          email: "contact@yamloveme.com",
          phone: "+1 555-5678",
          whatsapp: "+1 555-1234",
          regDate: "2019-04-12",
          indexedDate: "2024-06-01",
          collectionsCount: 12,
          productCount: 1900,
          avgPrice: "37.69 USD",
          latestProduct: "Heart Pendant Necklace",
          latestProductDate: "2024-05-01",
          country: "US",
          language: "EN",
          facebook: "facebook.com/yamloveme",
          instagram: "instagram.com/yamloveme",
          youtube: "youtube.com/yamloveme",
          pinterest: "pinterest.com/yamloveme",
          tiktok: "tiktok.com/@yamloveme",
          twitter: "twitter.com/yamloveme",
          fbAdCount: 8,
          facebookFollowers: 2100,
          instagramFollowers: 5400,
          youtubeFollowers: 800,
          pinterestFollowers: 1200,
          // ...add more fields as needed
        },
        "true-compress.com": {
          domain: "true-compress.com",
          name: "True Compress",
          owner: "John Doe",
          traffic: "4,200/mo",
          dateAdded: "2022-08-15",
          hosting: "Shopify",
          tags: ["Athletic", "Compression", "GB"],
          description: "Compression wear for athletes",
          email: "support@true-compress.com",
          phone: "+44 20 1234 5678",
          whatsapp: "+44 7700 900123",
          regDate: "2021-08-22",
          indexedDate: "2024-06-01",
          collectionsCount: 3,
          productCount: 10,
          avgPrice: "42.04 GBP",
          latestProduct: "Pro Compression Shorts",
          latestProductDate: "2024-05-15",
          country: "GB",
          language: "EN",
          facebook: "facebook.com/truecompress",
          instagram: "instagram.com/truecompress",
          youtube: "youtube.com/truecompress",
          pinterest: "pinterest.com/truecompress",
          tiktok: "tiktok.com/@truecompress",
          twitter: "twitter.com/truecompress",
          fbAdCount: 2,
          facebookFollowers: 1000,
          instagramFollowers: 2300,
          youtubeFollowers: 300,
          pinterestFollowers: 500,
        },
        "dbfay.com": {
          domain: "dbfay.com",
          name: "dbfay",
          owner: "Marie Dubois",
          traffic: "7,800/mo",
          dateAdded: "2021-03-10",
          hosting: "Shopify",
          tags: ["Fashion", "Accessories", "FR"],
          description: "Fashion and accessories",
          email: "contact@dbfay.com",
          phone: "+33 1 23 45 67 89",
          whatsapp: "+33 6 12 34 56 78",
          regDate: "2020-02-18",
          indexedDate: "2024-06-01",
          collectionsCount: 6,
          productCount: 840,
          avgPrice: "35.56 EUR",
          latestProduct: "Parisian Silk Scarf",
          latestProductDate: "2024-05-25",
          country: "FR",
          language: "FR",
          facebook: "facebook.com/dbfay",
          instagram: "instagram.com/dbfay",
          youtube: "youtube.com/dbfay",
          pinterest: "pinterest.com/dbfay",
          tiktok: "tiktok.com/@dbfay",
          twitter: "twitter.com/dbfay",
          fbAdCount: 3,
          facebookFollowers: 1500,
          instagramFollowers: 2800,
          youtubeFollowers: 400,
          pinterestFollowers: 600,
        },
        "epicfalls.legendary-laughs.shop": {
          domain: "epicfalls.legendary-laughs.shop",
          name: "Epic Falls: Legendary Laughs!",
          owner: "Mike Johnson",
          traffic: "2,200/mo",
          dateAdded: "2022-03-01",
          hosting: "Shopify",
          tags: ["Humor", "Gifts", "US"],
          description: "Humor gifts and novelties",
          email: "",
          phone: "+1 555-9876",
          whatsapp: "+1 555-4321",
          regDate: "2022-01-05",
          indexedDate: "2024-06-01",
          collectionsCount: 1,
          productCount: 3,
          avgPrice: "1623.08 USD",
          latestProduct: "Legendary Prank Kit",
          latestProductDate: "2024-05-28",
          country: "US",
          language: "EN",
          facebook: "facebook.com/epicfalls",
          instagram: "instagram.com/epicfalls",
          youtube: "youtube.com/epicfalls",
          pinterest: "pinterest.com/epicfalls",
          tiktok: "tiktok.com/@epicfalls",
          twitter: "twitter.com/epicfalls",
          fbAdCount: 1,
          facebookFollowers: 500,
          instagramFollowers: 1000,
          youtubeFollowers: 100,
          pinterestFollowers: 200,
        },
        "akitada.com": {
          domain: "akitada.com",
          name: "akitada",
          owner: "Hans Müller",
          traffic: "3,500/mo",
          dateAdded: "2018-09-15",
          hosting: "Shopify",
          tags: ["Home Goods", "Japanese", "DE"],
          description: "Japanese home goods",
          email: "kontakt@akitada.com",
          phone: "+49 30 123456",
          whatsapp: "+49 170 1234567",
          regDate: "2017-07-30",
          indexedDate: "2024-06-01",
          collectionsCount: 4,
          productCount: 165,
          avgPrice: "29.96 EUR",
          latestProduct: "Bamboo Tea Set",
          latestProductDate: "2024-05-30",
          country: "DE",
          language: "DE",
          facebook: "facebook.com/akitada",
          instagram: "instagram.com/akitada",
          youtube: "youtube.com/akitada",
          pinterest: "pinterest.com/akitada",
          tiktok: "tiktok.com/@akitada",
          twitter: "twitter.com/akitada",
          fbAdCount: 0,
          facebookFollowers: 800,
          instagramFollowers: 1200,
          youtubeFollowers: 150,
          pinterestFollowers: 300,
        },
        "avapros.com": {
          domain: "avapros.com",
          name: "avapros",
          owner: "Dewi Lestari",
          traffic: "6,200/mo",
          dateAdded: "2017-05-22",
          hosting: "Shopify",
          tags: ["Beauty", "Professional", "ID"],
          description: "Professional beauty products",
          email: "cs@avapros.com",
          phone: "+62 21 123456",
          whatsapp: "+62 812 3456 7890",
          regDate: "2016-03-14",
          indexedDate: "2024-06-01",
          collectionsCount: 10,
          productCount: 1181,
          avgPrice: "35.73 IDR",
          latestProduct: "Pro Makeup Kit",
          latestProductDate: "2024-05-18",
          country: "ID",
          language: "ID",
          facebook: "facebook.com/avapros",
          instagram: "instagram.com/avapros",
          youtube: "youtube.com/avapros",
          pinterest: "pinterest.com/avapros",
          tiktok: "tiktok.com/@avapros",
          twitter: "twitter.com/avapros",
          fbAdCount: 4,
          facebookFollowers: 2000,
          instagramFollowers: 3500,
          youtubeFollowers: 600,
          pinterestFollowers: 900,
        },
        "blackrow.com": {
          domain: "blackrow.com",
          name: "blackrow",
          owner: "Nguyen Van A",
          traffic: "9,100/mo",
          dateAdded: "2016-08-10",
          hosting: "Shopify",
          tags: ["Streetwear", "Urban", "VN"],
          description: "Streetwear and urban fashion",
          email: "hello@blackrow.com",
          phone: "+84 28 1234 5678",
          whatsapp: "+84 912 345 678",
          regDate: "2015-12-01",
          indexedDate: "2024-06-01",
          collectionsCount: 7,
          productCount: 1385,
          avgPrice: "43.57 VND",
          latestProduct: "Urban Hoodie",
          latestProductDate: "2024-05-10",
          country: "VN",
          language: "VI",
          facebook: "facebook.com/blackrow",
          instagram: "instagram.com/blackrow",
          youtube: "youtube.com/blackrow",
          pinterest: "pinterest.com/blackrow",
          tiktok: "tiktok.com/@blackrow",
          twitter: "twitter.com/blackrow",
          fbAdCount: 6,
          facebookFollowers: 1800,
          instagramFollowers: 4200,
          youtubeFollowers: 700,
          pinterestFollowers: 1100,
        },
        "foxness.com": {
          domain: "foxness.com",
          name: "foxness",
          owner: "Sophie Janssen",
          traffic: "2,900/mo",
          dateAdded: "2023-03-01",
          hosting: "Shopify",
          tags: ["Pets", "Accessories", "NL"],
          description: "Pet accessories and toys",
          email: "info@foxness.com",
          phone: "+31 20 1234567",
          whatsapp: "+31 6 12345678",
          regDate: "2023-02-14",
          indexedDate: "2024-06-01",
          collectionsCount: 5,
          productCount: 610,
          avgPrice: "31.95 EUR",
          latestProduct: "Fox Plush Toy",
          latestProductDate: "2024-05-29",
          country: "NL",
          language: "NL",
          facebook: "facebook.com/foxness",
          instagram: "instagram.com/foxness",
          youtube: "youtube.com/foxness",
          pinterest: "pinterest.com/foxness",
          tiktok: "tiktok.com/@foxness",
          twitter: "twitter.com/foxness",
          fbAdCount: 2,
          facebookFollowers: 900,
          instagramFollowers: 1500,
          youtubeFollowers: 250,
          pinterestFollowers: 400,
        },
        "cofuze.com": {
          domain: "cofuze.com",
          name: "cofuze.com - CoFuze™",
          owner: "Arjun Patel",
          traffic: "1,200/mo",
          dateAdded: "2022-12-01",
          hosting: "Shopify",
          tags: ["Coffee", "Accessories", "IN"],
          description: "Coffee accessories and mugs",
          email: "support@cofuze.com",
          phone: "+91 44 1234 5678",
          whatsapp: "+91 90000 56789",
          regDate: "2022-10-10",
          indexedDate: "2024-06-01",
          collectionsCount: 2,
          productCount: 90,
          avgPrice: "87.64 INR",
          latestProduct: "Insulated Mug",
          latestProductDate: "2024-05-31",
          country: "IN",
          language: "EN",
          facebook: "facebook.com/cofuze",
          instagram: "instagram.com/cofuze",
          youtube: "youtube.com/cofuze",
          pinterest: "pinterest.com/cofuze",
          tiktok: "tiktok.com/@cofuze",
          twitter: "twitter.com/cofuze",
          fbAdCount: 0,
          facebookFollowers: 400,
          instagramFollowers: 900,
          youtubeFollowers: 50,
          pinterestFollowers: 100,
        }
        // ...rest of the code...
      };

      // --- END MOCK DATA SECTION ---

      // Details panel logic, always show full data for clicked row
      document.addEventListener("DOMContentLoaded", function () {
        const detailsPanel = document.getElementById('detailsPanel');
        const detailsContent = document.getElementById('detailsContent');
        const resultsTable = document.querySelector('table');

        // Helper: render all fields from the full data object
        function renderFullDetails(data) {
          // Responsive grid for details
          return `
<div class="p-4 md:p-8">
  <div class="bg-white rounded-lg shadow-md p-4 md:p-6 mb-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
      <div class="flex items-center">
        <div class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center mr-3">
          <i class="ri-global-line text-white text-lg"></i>
        </div>
        <h2 class="text-xl font-semibold break-words">${data.domain || data.name || ''}</h2>
      </div>
      <div class="flex flex-wrap gap-2 mt-2 md:mt-0">
        ${(data.tags||[]).map(tag=>`<span class="bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full">${tag}</span>`).join('')}
      </div>
    </div>
    <div class="space-y-6">
      <h3 class="text-lg font-semibold mb-4">Website Details</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6">
        <div>
          <p class="text-sm text-gray-500 mb-1">Site Name</p>
          <div class="font-medium break-words">${data.name||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Owner</p>
          <div class="font-medium break-words">${data.owner||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Domain</p>
          <div class="font-medium break-words">${data.domain||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Traffic</p>
          <div class="font-medium break-words">${data.traffic||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Date Added</p>
          <div class="font-medium break-words">${data.dateAdded||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Hosting Type</p>
          <div class="font-medium break-words">${data.hosting||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Country</p>
          <div class="font-medium break-words">${data.country||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Language</p>
          <div class="font-medium break-words">${data.language||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Description</p>
          <div class="font-medium break-words">${data.description||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Email</p>
          <div class="font-medium break-words">${data.email||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Phone</p>
          <div class="font-medium break-words">${data.phone||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">WhatsApp</p>
          <div class="font-medium break-words">${data.whatsapp||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Domain Reg Date</p>
          <div class="font-medium break-words">${data.regDate||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Indexed Date</p>
          <div class="font-medium break-words">${data.indexedDate||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Collections Count</p>
          <div class="font-medium break-words">${data.collectionsCount||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Product Count</p>
          <div class="font-medium break-words">${data.productCount||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Avg Product Price</p>
          <div class="font-medium break-words">${data.avgPrice||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Latest Product</p>
          <div class="font-medium break-words">${data.latestProduct||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Latest Product Date</p>
          <div class="font-medium break-words">${data.latestProductDate||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Facebook</p>
          <div class="font-medium break-words"><a href="https://${data.facebook||'#'}" target="_blank">${data.facebook||''}</a></div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Instagram</p>
          <div class="font-medium break-words"><a href="https://${data.instagram||'#'}" target="_blank">${data.instagram||''}</a></div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">YouTube</p>
          <div class="font-medium break-words"><a href="https://${data.youtube||'#'}" target="_blank">${data.youtube||''}</a></div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Pinterest</p>
          <div class="font-medium break-words"><a href="https://${data.pinterest||'#'}" target="_blank">${data.pinterest||''}</a></div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">TikTok</p>
          <div class="font-medium break-words"><a href="https://${data.tiktok||'#'}" target="_blank">${data.tiktok||''}</a></div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Twitter</p>
          <div class="font-medium break-words"><a href="https://${data.twitter||'#'}" target="_blank">${data.twitter||''}</a></div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">FB Ad Count (Past 30 Days)</p>
          <div class="font-medium break-words">${data.fbAdCount||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Facebook Followers</p>
          <div class="font-medium break-words">${data.facebookFollowers||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Instagram Followers</p>
          <div class="font-medium break-words">${data.instagramFollowers||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">YouTube Followers</p>
          <div class="font-medium break-words">${data.youtubeFollowers||''}</div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-1">Pinterest Followers</p>
          <div class="font-medium break-words">${data.pinterestFollowers||''}</div>
        </div>
      </div>
    </div>
  </div>
</div>
          `;
        }

        // Show panel and populate content on row click
        resultsTable.addEventListener('click', function (e) {
          const row = e.target.closest('.result-row');
          if (!row) return;
          // Use domain as key for demo/mock data
          const domain = row.getAttribute('data-domain');
          // In production, fetch full data from backend/API here
          const data = websiteFullData[domain];
          if (!data) {
            detailsContent.innerHTML = `<div class="p-8 text-gray-400 text-center">No details available for this website.</div>`;
          } else {
            detailsContent.innerHTML = renderFullDetails(data);
          }
          detailsPanel.classList.remove('translate-x-full');
          detailsPanel.classList.add('translate-x-0');
        });

        // Clear details panel on filter reset (button with text "Reset")
        document.querySelectorAll('button').forEach(btn => {
          if (btn.textContent.trim().toLowerCase() === 'reset') {
            btn.addEventListener('click', function () {
              detailsPanel.classList.remove('translate-x-0');
              detailsPanel.classList.add('translate-x-full');
              detailsContent.innerHTML = '';
            });
          }
        });

        // Optional: close on click outside
        document.addEventListener('mousedown', function (e) {
          if (!detailsPanel.contains(e.target) && !e.target.closest('.result-row')) {
            detailsPanel.classList.remove('translate-x-0');
            detailsPanel.classList.add('translate-x-full');
            detailsContent.innerHTML = '';
          }
        });
      });
    </script>

    <div class="p-4">
      <h2 class="text-xl font-bold mb-4">Filter Stores</h2>
      <div class="mb-4">
        <label for="platform">Platform:</label>
        <select id="platform" class="border rounded p-2">
          <option value="">All</option>
          <option value="shopify">Shopify</option>
          <option value="woocommerce">WooCommerce</option>
          <option value="etsy">Etsy</option>
          <option value="ebay">eBay</option>
          <option value="square">Square</option>
        </select>
      </div>
      <div class="mb-4">
        <label for="created_after">Created After:</label>
        <input type="date" id="created_after" class="border rounded p-2">
      </div>
      <div class="mb-4">
        <label for="created_before">Created Before:</label>
        <input type="date" id="created_before" class="border rounded p-2">
      </div>
      <div class="flex gap-2">
        <button id="filterButton" class="bg-blue-500 text-white p-2 rounded">Filter</button>
        <form id="exportForm" method="GET" action="../api/export_csv.php" target="_blank" class="inline">
          <input type="hidden" name="platform" id="exportPlatform">
          <input type="hidden" name="created_after" id="exportCreatedAfter">
          <input type="hidden" name="created_before" id="exportCreatedBefore">
          <button type="submit" id="exportButton" class="bg-green-500 text-white p-2 rounded">Export CSV</button>
        </form>
      </div>
    </div>

    <div id="results" class="p-4">
      <!-- Results will be displayed here -->
    </div>

    <div id="pagination" class="p-4 flex justify-center gap-2">
      <!-- Pagination will be displayed here -->
    </div>

    <div id="storeDetailsPanel" class="fixed right-0 top-0 h-full w-1/3 bg-white shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out">
      <div class="p-4">
        <h3 id="storeName" class="text-xl font-bold"></h3>
        <p id="storeUrl" class="text-blue-500"></p>
        <p id="storePlatform"></p>
        <p id="storeCountry"></p>
        <p id="storeCategory"></p>
        <p id="storeCreationDate"></p>
        <p id="storeAddedOn"></p>
        <button id="closePanel" class="mt-4 bg-red-500 text-white p-2 rounded">Close</button>
      </div>
    </div>

    <script>
    let currentPage = 1;
    const itemsPerPage = 10;
    let isIntelligenceMode = false;
    let autoUpdateInterval = null;

    function fetchStores(page = 1, autoUpdate = false) {
      currentPage = page;
      const platformEl = document.getElementById('platformFilter');
      const categoryEl = document.getElementById('categorySelect');
      const createdAfterEl = document.getElementById('indexedDateFilter');
      
      const platform = platformEl?.value || '';
      const category = categoryEl?.value || '';
      const createdAfter = createdAfterEl?.value || '';
      
      const resultsDiv = document.getElementById('results');
      const paginationDiv = document.getElementById('pagination');
      const resultsCount = document.getElementById('resultsCount');
      
      // Check if required elements exist
      if (!resultsDiv || !paginationDiv) {
        console.error('Required DOM elements not found');
        return;
      }
      
      // Show loading state
      if (resultsCount) resultsCount.textContent = 'Loading stores...';

      // Choose API endpoint based on mode
      let url;
      if (isIntelligenceMode) {
        url = `../api/fetch_shopify_intelligence.php?page=${currentPage}&limit=${itemsPerPage}&platform=shopify&category=${encodeURIComponent(category)}&auto_update=${autoUpdate}`;
        console.log('Using intelligence API:', url);
      } else {
        url = `../api/filter_stores.php?page=${currentPage}&limit=${itemsPerPage}&platform=${encodeURIComponent(platform)}&created_after=${encodeURIComponent(createdAfter)}`;
        console.log('Using regular API:', url);
      }

      fetch(url)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.text(); // Get as text first to check content
        })
        .then(text => {
          // Try to parse as JSON
          let data;
          try {
            data = JSON.parse(text);
          } catch (e) {
            console.error('Invalid JSON response:', text);
            throw new Error('Server returned invalid JSON response');
          }
          return data;
        })
        .then(data => {
          resultsDiv.innerHTML = ''; // Clear previous results
          paginationDiv.innerHTML = ''; // Clear previous pagination

          if (data.stores && Array.isArray(data.stores) && data.stores.length > 0) {
            console.log('Processing stores data:', data.stores.length, 'stores found');
            console.log('First store sample:', data.stores[0]);
            
            // Create table with proper structure
            const tableHTML = `
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Store</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Platform</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Country</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product Count</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Avg Price</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Currency</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  ${data.stores.map(store => {
                    // Safe value extraction with fallbacks
                    const domain = store.domain || store.url || store.website || 'N/A';
                    const platform = store.platform || store.tech_stack || 'Shopify';
                    const title = store.title || store.name || store.site_name || domain;
                    const description = store.description || store.meta_description || 'No description available';
                    const country = store.country || store.country_code || 'N/A';
                    const productCount = store.product_count || store.products_count || '0';
                    const avgPrice = store.avg_price || store.average_price || '0.00';
                    const currency = store.currency || store.currency_code || 'USD';
                    
                    return `
                      <tr class="hover:bg-gray-50 cursor-pointer" onclick="showStoreDetails('${encodeURIComponent(JSON.stringify(store))}')">
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div class="flex items-center">
                            <div class="w-8 h-8 flex items-center justify-center bg-blue-100 rounded-full mr-3">
                              <i class="ri-store-2-fill text-blue-500"></i>
                            </div>
                            <div class="text-sm font-medium text-gray-900">${domain}</div>
                          </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${platform}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${title}</td>
                        <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate" title="${description}">${description}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${country}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${productCount}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${avgPrice}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${currency}</td>
                      </tr>
                    `;
                  }).join('')}
                </tbody>
              </table>
            `;
            
            resultsDiv.innerHTML = tableHTML;
            
            // Update results count
            if (resultsCount) {
              const total = data.pagination?.total || data.stores.length;
              const showing = data.stores.length;
              const pageNum = data.pagination?.page || 1;
              resultsCount.textContent = `Showing ${showing} stores (Page ${pageNum} of ${data.pagination?.total_pages || 1})`;
            }

            // Create pagination controls
            const pagination = data.pagination;
            if (pagination && pagination.total_pages > 1) {
              let paginationHTML = '<div class="flex items-center justify-between">';
              
              // Page info
              paginationHTML += `<div class="flex items-center">`;
              paginationHTML += `<p class="text-sm text-gray-700">`;
              paginationHTML += `Showing <span class="font-medium">${((pagination.page - 1) * itemsPerPage) + 1}</span> to `;
              paginationHTML += `<span class="font-medium">${Math.min(pagination.page * itemsPerPage, pagination.total)}</span> of `;
              paginationHTML += `<span class="font-medium">${pagination.total}</span> results`;
              paginationHTML += `</p></div>`;
              
              // Navigation buttons
              paginationHTML += '<div class="flex items-center space-x-2">';
              
              // Previous button
              if (pagination.page > 1) {
                paginationHTML += `<button onclick="fetchStores(${pagination.page - 1})" class="text-gray-500 hover:bg-gray-100 w-8 h-8 rounded flex items-center justify-center">`;
                paginationHTML += '<i class="ri-arrow-left-s-line"></i></button>';
              }
              
              // Page numbers (show max 5 pages)
              const startPage = Math.max(1, pagination.page - 2);
              const endPage = Math.min(pagination.total_pages, startPage + 4);
              
              for (let i = startPage; i <= endPage; i++) {
                if (i === pagination.page) {
                  paginationHTML += `<button class="bg-primary text-white w-8 h-8 rounded flex items-center justify-center"><span>${i}</span></button>`;
                } else {
                  paginationHTML += `<button onclick="fetchStores(${i})" class="text-gray-500 hover:bg-gray-100 w-8 h-8 rounded flex items-center justify-center"><span>${i}</span></button>`;
                }
              }
              
              // Show ellipsis and last page if needed
              if (endPage < pagination.total_pages) {
                if (endPage < pagination.total_pages - 1) {
                  paginationHTML += '<span class="text-gray-500">...</span>';
                }
                paginationHTML += `<button onclick="fetchStores(${pagination.total_pages})" class="text-gray-500 hover:bg-gray-100 w-8 h-8 rounded flex items-center justify-center"><span>${pagination.total_pages}</span></button>`;
              }
              
              // Next button
              if (pagination.page < pagination.total_pages) {
                paginationHTML += `<button onclick="fetchStores(${pagination.page + 1})" class="text-gray-500 hover:bg-gray-100 w-8 h-8 rounded flex items-center justify-center">`;
                paginationHTML += '<i class="ri-arrow-right-s-line"></i></button>';
              }
              
              paginationHTML += '</div></div>';
              paginationDiv.innerHTML = paginationHTML;
            } else {
              paginationDiv.innerHTML = '';
            }
          } else {
            resultsDiv.innerHTML = `
              <div class="text-center py-12">
                <div class="w-16 h-16 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-4">
                  <i class="ri-database-line text-2xl text-gray-400"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No stores found</h3>
                <p class="text-gray-500 mb-4">Try adjusting your filters or check back later for new data.</p>
                <button onclick="fetchStores(1, true)" class="bg-primary text-white px-4 py-2 rounded-button">Refresh Data</button>
              </div>
            `;
            paginationDiv.innerHTML = '';
            if (resultsCount) resultsCount.textContent = 'No stores found';
          }
        })
        .catch(error => {
          console.error('Error fetching stores:', error);
          console.error('API URL was:', url);
          console.error('Intelligence mode:', isIntelligenceMode);
          
          resultsDiv.innerHTML = `
            <div class="text-center py-12">
              <div class="w-16 h-16 mx-auto bg-red-100 rounded-full flex items-center justify-center mb-4">
                <i class="ri-error-warning-line text-2xl text-red-400"></i>
              </div>
              <h3 class="text-lg font-medium text-gray-900 mb-2">Failed to load data</h3>
              <p class="text-red-500 mb-2">${error.message}</p>
              <p class="text-gray-500 mb-4">Check console for details. URL: ${url}</p>
              <button onclick="fetchStores(1)" class="bg-primary text-white px-4 py-2 rounded-button">Retry</button>
            </div>
          `;
          if (resultsCount) resultsCount.textContent = 'Error loading data';
        });
    }

    function showStoreDetails(storeData) {
      let store;
      try {
        store = typeof storeData === 'string' ? JSON.parse(decodeURIComponent(storeData)) : storeData;
      } catch (e) {
        console.error('Error parsing store data:', e);
        return;
      }
      
      // Safe value extraction
      const domain = store.domain || store.url || store.website || 'N/A';
      const title = store.title || store.name || store.site_name || domain;
      const description = store.description || store.meta_description || 'No description available';
      const platform = store.platform || store.tech_stack || 'Shopify';
      const country = store.country || store.country_code || 'N/A';
      const language = store.language || store.language_code || 'N/A';
      const productCount = store.product_count || store.products_count || '0';
      const avgPrice = store.avg_price || store.average_price || '0.00';
      const currency = store.currency || store.currency_code || 'USD';
      const email = store.contact_email || store.email || 'N/A';
      const phone = store.contact_phone || store.phone || 'N/A';
      const whatsapp = store.whatsapp_number || store.whatsapp || 'N/A';
      const dateAdded = store.date_added ? new Date(store.date_added).toLocaleDateString() : 'N/A';
      
      const detailsContent = `
        <div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" id="detailsPanel">
          <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="flex items-center justify-between border-b border-gray-200 pb-4 mb-6">
              <div class="flex items-center">
                <div class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center mr-3">
                  <i class="ri-global-line text-white text-lg"></i>
                </div>
                <h2 class="text-xl font-semibold break-words">${title}</h2>
              </div>
              <button onclick="closeStoreDetails()" class="text-gray-400 hover:text-gray-600">
                <i class="ri-close-line text-xl"></i>
              </button>
            </div>
            <div class="space-y-6">
              <h3 class="text-lg font-semibold mb-4">Store Details</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6">
                <div>
                  <p class="text-sm text-gray-500 mb-1">Domain</p>
                  <div class="font-medium break-words">${domain}</div>
                </div>
                <div>
                  <p class="text-sm text-gray-500 mb-1">Platform</p>
                  <div class="font-medium break-words">${platform}</div>
                </div>
                <div>
                  <p class="text-sm text-gray-500 mb-1">Country</p>
                  <div class="font-medium break-words">${country}</div>
                </div>
                <div>
                  <p class="text-sm text-gray-500 mb-1">Language</p>
                  <div class="font-medium break-words">${language}</div>
                </div>
                <div>
                  <p class="text-sm text-gray-500 mb-1">Product Count</p>
                  <div class="font-medium break-words">${productCount}</div>
                </div>
                <div>
                  <p class="text-sm text-gray-500 mb-1">Average Price</p>
                  <div class="font-medium break-words">${avgPrice} ${currency}</div>
                </div>
                <div>
                  <p class="text-sm text-gray-500 mb-1">Contact Email</p>
                  <div class="font-medium break-words">${email}</div>
                </div>
                <div>
                  <p class="text-sm text-gray-500 mb-1">Contact Phone</p>
                  <div class="font-medium break-words">${phone}</div>
                </div>
                <div>
                  <p class="text-sm text-gray-500 mb-1">WhatsApp</p>
                  <div class="font-medium break-words">${whatsapp}</div>
                </div>
                <div>
                  <p class="text-sm text-gray-500 mb-1">Date Added</p>
                  <div class="font-medium break-words">${dateAdded}</div>
                </div>
              </div>
              <div>
                <p class="text-sm text-gray-500 mb-1">Description</p>
                <div class="font-medium break-words">${description}</div>
              </div>
            </div>
            <div class="mt-6 pt-4 border-t border-gray-200 flex justify-end">
              <button onclick="closeStoreDetails()" class="bg-gray-500 text-white px-4 py-2 rounded-button mr-2">Close</button>
              <a href="https://${domain}" target="_blank" class="bg-primary text-white px-4 py-2 rounded-button">Visit Store</a>
            </div>
          </div>
        </div>
      `;
      
      // Remove existing details panel if any
      const existingPanel = document.getElementById('detailsPanel');
      if (existingPanel) {
        existingPanel.remove();
      }
      
      // Add new details panel to body
      document.body.insertAdjacentHTML('beforeend', detailsContent);
    }
    
    function closeStoreDetails() {
      const panel = document.getElementById('detailsPanel');
      if (panel) {
        panel.remove();
      }
    }

    // Event listeners
    document.getElementById('searchBtn').addEventListener('click', () => fetchStores(1));
    document.getElementById('resetBtn').addEventListener('click', () => {
      document.getElementById('platformFilter').value = '';
      if (document.getElementById('categorySelect')) document.getElementById('categorySelect').value = '';
      fetchStores(1);
    });
    
    // Intelligence mode toggle
    document.getElementById('toggleIntelligenceData').addEventListener('change', function() {
      isIntelligenceMode = this.checked;
      const categoryFilter = document.getElementById('categoryFilter');
      
      if (isIntelligenceMode) {
        categoryFilter.classList.remove('hidden');
        document.getElementById('platformFilter').value = 'shopify';
        document.getElementById('platformFilter').disabled = true;
      } else {
        categoryFilter.classList.add('hidden');
        document.getElementById('platformFilter').disabled = false;
      }
      
      fetchStores(1, isIntelligenceMode);
    });
    
    // Auto-update functionality
    document.getElementById('autoUpdateBtn').addEventListener('click', function() {
      if (autoUpdateInterval) {
        clearInterval(autoUpdateInterval);
        autoUpdateInterval = null;
        this.innerHTML = '<i class="ri-refresh-line mr-1"></i>Auto Update';
        this.classList.remove('bg-red-500', 'hover:bg-red-600');
        this.classList.add('bg-green-500', 'hover:bg-green-600');
      } else {
        fetchStores(1, true);
        autoUpdateInterval = setInterval(() => {
          if (isIntelligenceMode) fetchStores(currentPage, true);
        }, 3600000); // 1 hour
        this.innerHTML = '<i class="ri-stop-line mr-1"></i>Stop Auto Update';
        this.classList.remove('bg-green-500', 'hover:bg-green-600');
        this.classList.add('bg-red-500', 'hover:bg-red-600');
      }
    });

    document.getElementById('closePanel').addEventListener('click', function() {
      document.getElementById('storeDetailsPanel').classList.add('translate-x-full');
    });

    document.addEventListener('click', function(event) {
      const panel = document.getElementById('storeDetailsPanel');
      if (panel && !panel.contains(event.target) && !event.target.closest('#results') && !event.target.closest('#filterButton') && !event.target.closest('#exportButton') && !event.target.closest('#display-columns-btn')) {
        panel.classList.add('translate-x-full');
      }
    });

    // Initial load
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing dashboard...');
      
      // Since this is the E-commerce tab, enable intelligence mode by default
      isIntelligenceMode = true;
      const toggleSwitch = document.getElementById('toggleIntelligenceData');
      const categoryFilter = document.getElementById('categoryFilter');
      const platformFilter = document.getElementById('platformFilter');
      const resultsDiv = document.getElementById('results');
      const resultsCount = document.getElementById('resultsCount');
      
      console.log('Elements found:', {
        toggleSwitch: !!toggleSwitch,
        categoryFilter: !!categoryFilter,
        platformFilter: !!platformFilter,
        resultsDiv: !!resultsDiv,
        resultsCount: !!resultsCount
      });
      
      if (toggleSwitch) {
        toggleSwitch.checked = true;
        console.log('Toggle switch enabled');
      }
      
      if (categoryFilter) {
        categoryFilter.classList.remove('hidden');
        console.log('Category filter shown');
      }
      
      if (platformFilter) {
        platformFilter.value = 'shopify';
        platformFilter.disabled = true;
        console.log('Platform filter set to Shopify');
      }
      
      // Force the results count to show intelligence mode
      if (resultsCount) {
        resultsCount.textContent = 'Loading competitive intelligence...';
      }
      
      // Ensure results div is ready
      if (resultsDiv) {
        resultsDiv.innerHTML = `
          <div class="text-center py-12">
            <div class="w-16 h-16 mx-auto bg-blue-100 rounded-full flex items-center justify-center mb-4 animate-pulse">
              <i class="ri-refresh-line text-2xl text-blue-500"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Loading Intelligence Data</h3>
            <p class="text-gray-500">Fetching competitive intelligence from Shopify stores...</p>
          </div>
        `;
      }
      
      // Wait a bit for all elements to be ready, then fetch data
      setTimeout(() => {
        console.log('Starting data fetch...');
        if (resultsDiv && resultsCount) {
          fetchStores(1, true); // Auto-update on initial load to get fresh data
        } else {
          console.error('Required DOM elements not found for data loading');
        }
      }, 500);
    });
    </script>
  </body>
</html>