<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { primary: "#1E3A8A", secondary: "#5BC0EB" },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <style>
      :where([class^="ri-"])::before {
        content: "\f3c2";
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: #f8f9fb;
      }

      .sidebar-transition {
        transition: width 0.3s ease, transform 0.3s ease;
      }

      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      .custom-switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
      }

      .custom-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .switch-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #e2e8f0;
        transition: 0.4s;
        border-radius: 24px;
      }

      .switch-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .switch-slider {
        background-color: #3366ff;
      }

      input:checked + .switch-slider:before {
        transform: translateX(20px);
      }

      .custom-checkbox {
        position: relative;
        display: inline-block;
        width: 18px;
        height: 18px;
      }

      .custom-checkbox input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .checkbox-mark {
        position: absolute;
        top: 0;
        left: 0;
        height: 18px;
        width: 18px;
        background-color: #fff;
        border: 1px solid #d1d5db;
        border-radius: 4px;
      }

      .custom-checkbox input:checked ~ .checkbox-mark {
        background-color: #3366ff;
        border-color: #3366ff;
      }

      .checkbox-mark:after {
        content: "";
        position: absolute;
        display: none;
      }

      .custom-checkbox input:checked ~ .checkbox-mark:after {
        display: block;
      }

      .custom-checkbox .checkbox-mark:after {
        left: 6px;
        top: 2px;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }

      .custom-radio {
        position: relative;
        display: inline-block;
        width: 18px;
        height: 18px;
      }

      .custom-radio input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .radio-mark {
        position: absolute;
        top: 0;
        left: 0;
        height: 18px;
        width: 18px;
        background-color: #fff;
        border: 1px solid #d1d5db;
        border-radius: 50%;
      }

      .custom-radio input:checked ~ .radio-mark {
        background-color: #fff;
        border-color: #3366ff;
      }

      .radio-mark:after {
        content: "";
        position: absolute;
        display: none;
      }

      .custom-radio input:checked ~ .radio-mark:after {
        display: block;
      }

      .custom-radio .radio-mark:after {
        top: 4px;
        left: 4px;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #3366ff;
      }

      .pagination-item {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        cursor: pointer;
      }

      .pagination-item.active {
        background-color: #3366ff;
        color: white;
      }

      .custom-select {
        position: relative;
        display: inline-block;
      }

      .custom-select-trigger {
        padding: 8px 12px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        background-color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        min-width: 120px;
      }

      .custom-select-options {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background-color: white;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        margin-top: 4px;
        z-index: 10;
        display: none;
        max-height: 200px;
        overflow-y: auto;
      }

      .custom-select-option {
        padding: 8px 12px;
        cursor: pointer;
      }

      .custom-select-option:hover {
        background-color: #f1f5f9;
      }

      .custom-select.open .custom-select-options {
        display: block;
      }

      .modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 50;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }

      .modal.active {
        opacity: 1;
        visibility: visible;
      }

      .modal-content {
        background-color: white;
        border-radius: 12px;
        padding: 24px;
        width: 100%;
        max-width: 500px;
        transform: translateY(20px);
        transition: transform 0.3s ease;
      }

      .modal.active .modal-content {
        transform: translateY(0);
      }
    </style>
  </head>

  <body class="min-h-screen">
    <!-- Header and Sidebar (optional for standalone) -->
    <header class="bg-white shadow-sm fixed top-0 left-0 right-0 z-30">
      <div class="flex items-center justify-between px-4 h-16">
        <div class="flex items-center">
          <button
            id="sidebar-toggle"
            class="w-10 h-10 flex items-center justify-center text-gray-500 hover:text-primary mr-2"
          >
            <i class="ri-menu-line ri-lg"></i>
          </button>
          <div class="font-['Pacifico'] text-xl text-primary">Sales-Spy</div>
          <span class="ml-4 text-lg font-medium hidden md:block"
            >Admin Dashboard</span
          >
        </div>
        <div class="flex items-center space-x-4">
          <div class="relative">
            <button
              id="notification-btn"
              class="w-10 h-10 flex items-center justify-center text-gray-500 hover:text-primary relative"
            >
              <i class="ri-notification-3-line ri-lg"></i>
              <span
                class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full"
              ></span>
            </button>
          </div>
          <div class="relative">
            <button id="user-menu-btn" class="flex items-center">
              <div
                class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center"
              >
                <span class="text-sm font-medium">JD</span>
              </div>
              <span class="ml-2 text-sm font-medium hidden md:block"
                >John Doe</span
              >
              <i class="ri-arrow-down-s-line ml-1 text-gray-500"></i>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Sidebar -->
    <aside
      id="sidebar"
      class="fixed top-16 left-0 bottom-0 w-64 bg-white shadow-sm z-20 sidebar-transition transform md:translate-x-0 -translate-x-full"
    >
      <div class="h-full flex flex-col">
        <div class="p-4 border-b">
          <div class="flex items-center">
            <div
              class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center"
            >
              <span class="text-sm font-medium">JD</span>
            </div>
            <div class="ml-3">
              <p class="text-sm font-medium">John Doe</p>
              <p class="text-xs text-gray-500">Super Admin</p>
            </div>
          </div>
        </div>
        <nav class="flex-1 p-4 overflow-y-auto">
          <ul class="space-y-1">
            <li>
              <a
          href="AdminUsers.html"
          class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-primary hover:bg-blue-50"
          <div class="w-5 h-5 flex items-center justify-center mr-3">
            <i class="ri-user-line"></i>-center justify-center mr-3">
          </div>lass="ri-user-line"></i>
          <span>Users</span>
              </a>sers</span>
              </button>
            </li>
              <a
          href="AdminSubscriptions.html"
          class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-primary bg-blue-50"
                class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-primary bg-blue-50"
          <div class="w-5 h-5 flex items-center justify-center mr-3">
            <i class="ri-vip-crown-line"></i>er justify-center mr-3">
          </div>lass="ri-vip-crown-line"></i>
          <span>Subscriptions</span>
              </a>ubscriptions</span>
              </button>
            </li>
              <a
          href="AdminWallets.html"
          class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-primary hover:bg-blue-50"
                class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-primary hover:bg-blue-50"
          <div class="w-5 h-5 flex items-center justify-center mr-3">
            <i class="ri-wallet-3-line"></i>ter justify-center mr-3">
          </div>lass="ri-wallet-3-line"></i>
          <span>Wallets</span>
              </a>allets</span>
              </button>
            </li>
              <a
          href="AdminPayments.html"
          class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-primary hover:bg-blue-50"
                class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-primary hover:bg-blue-50"
          <div class="w-5 h-5 flex items-center justify-center mr-3">
            <i class="ri-exchange-dollar-line"></i>tify-center mr-3">
          </div>lass="ri-exchange-dollar-line"></i>
          <span>Payments</span>
              </a>ayments</span>
              </button>
            <li>            </li>
              <a
          href="AdminPending.html"
          class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-primary hover:bg-blue-50"
              >
          <div class="w-5 h-5 flex items-center justify-center mr-3"> class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-primary hover:bg-blue-50"
            <i class="ri-time-line"></i>
          </div>-center justify-center mr-3">
          <span>Pending Payments</span>lass="ri-time-line"></i>
              </a>
            </li>ending Payments</span>
            <li>utton>
              <a>
          href="AdminSettings.html"
          class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-primary hover:bg-blue-50"
              >
          <div class="w-5 h-5 flex items-center justify-center mr-3"> class="nav-link w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-primary hover:bg-blue-50"
            <i class="ri-settings-3-line"></i>
          </div>r justify-center mr-3">
          <span>Settings</span>lass="ri-settings-3-line"></i>
              </a>
            </li>ettings</span>
          </ul>utton>
        </nav>i>
        </nav>
        <div class="p-4 border-t">
          <button
            id="logout-btn"
            class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-red-600 hover:bg-red-50"
          >
            <div class="w-5 h-5 flex items-center justify-center mr-3">
              <i class="ri-logout-box-line"></i>
            </div>
            <span>Logout</span>
          </button>
        </div>
        <!-- Logout Confirmation Modal -->
        <div id="logout-modal" class="modal">
          <div class="modal-content max-w-sm">
            <div class="flex items-center mb-4">
              <div
                class="w-12 h-12 rounded-full bg-red-100 text-red-600 flex items-center justify-center mr-4"
              >
                <i class="ri-logout-box-line ri-lg"></i>
              </div>
              <h3 class="text-lg font-medium text-gray-800">
                Are you sure you want to logout?
              </h3>
            </div>
            <div class="flex items-center justify-end space-x-3">
              <button
                id="cancel-logout"
                class="px-4 py-2 border border-gray-200 text-gray-600 rounded-button whitespace-nowrap hover:bg-gray-50"
              >
                Cancel
              </button>
              <button
                id="confirm-logout"
                class="px-4 py-2 bg-red-600 text-white rounded-button whitespace-nowrap hover:bg-red-700"
              >
                Logout
              </button>
            </div>
          </div>
        </div>
      </div>
    </aside>
    <main class="pt-16 md:pl-64 transition-all duration-300">
      <!-- Subscriptions Tab -->
      <div id="subscriptions-tab" class="tab-content p-4 md:p-6">
        <div class="mb-6">
          <h1 class="text-2xl font-semibold text-gray-800">
            Subscription Management
          </h1>
          <p class="text-sm text-gray-500 mt-1">
            Manage user subscriptions and plans
          </p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div class="bg-white rounded-lg shadow-sm p-4">
            <div class="flex items-center">
              <div
                class="w-12 h-12 rounded-full bg-blue-100 text-primary flex items-center justify-center"
              >
                <i class="ri-user-line ri-lg"></i>
              </div>
              <div class="ml-4">
                <p class="text-sm text-gray-500">Total Users</p>
                <p class="text-2xl font-semibold" id="subs-total-users">
                  1,254
                </p>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-lg shadow-sm p-4">
            <div class="flex items-center">
              <div
                class="w-12 h-12 rounded-full bg-green-100 text-green-600 flex items-center justify-center"
              >
                <i class="ri-vip-crown-line ri-lg"></i>
              </div>
              <div class="ml-4">
                <p class="text-sm text-gray-500">Active Subscriptions</p>
                <p class="text-2xl font-semibold" id="subs-active-count">876</p>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-lg shadow-sm p-4">
            <div class="flex items-center">
              <div
                class="w-12 h-12 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center"
              >
                <i class="ri-money-dollar-circle-line ri-lg"></i>
              </div>
              <div class="ml-4">
                <p class="text-sm text-gray-500">Monthly Revenue</p>
                <p class="text-2xl font-semibold" id="subs-monthly-revenue">
                  $45,890
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
          <div class="bg-white rounded-lg shadow-sm p-4 md:col-span-2">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-medium text-gray-800">
                Subscription Distribution
              </h2>
              <div class="custom-select" id="chart-period-select">
                <div class="custom-select-trigger">
                  <span>This Month</span>
                  <i class="ri-arrow-down-s-line ml-2"></i>
                </div>
                <div class="custom-select-options">
                  <div class="custom-select-option" data-value="week">
                    This Week
                  </div>
                  <div class="custom-select-option" data-value="month">
                    This Month
                  </div>
                  <div class="custom-select-option" data-value="quarter">
                    This Quarter
                  </div>
                  <div class="custom-select-option" data-value="year">
                    This Year
                  </div>
                </div>
              </div>
            </div>
            <div id="subscription-chart" class="w-full h-64"></div>
          </div>
          <div class="bg-white rounded-lg shadow-sm p-4">
            <h2 class="text-lg font-medium text-gray-800 mb-4">
              Plan Distribution
            </h2>
            <div id="plan-distribution-chart" class="w-full h-64"></div>
          </div>
        </div>
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
          <div class="p-4 border-b">
            <div
              class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
            >
              <h2 class="text-lg font-medium text-gray-800">
                Active Subscriptions
              </h2>
              <div class="flex flex-wrap items-center gap-3">
                <div class="custom-select" id="subscription-plan-filter">
                  <div class="custom-select-trigger">
                    <span>All Plans</span>
                    <i class="ri-arrow-down-s-line ml-2"></i>
                  </div>
                  <div class="custom-select-options">
                    <div class="custom-select-option" data-value="all">
                      All Plans
                    </div>
                    <div class="custom-select-option" data-value="basic">
                      Basic
                    </div>
                    <div class="custom-select-option" data-value="pro">Pro</div>
                    <div class="custom-select-option" data-value="enterprise">
                      Enterprise
                    </div>
                  </div>
                </div>
                <div class="custom-select" id="subscription-status-filter">
                  <div class="custom-select-trigger">
                    <span>All Status</span>
                    <i class="ri-arrow-down-s-line ml-2"></i>
                  </div>
                  <div class="custom-select-options">
                    <div class="custom-select-option" data-value="all">
                      All Status
                    </div>
                    <div class="custom-select-option" data-value="active">
                      Active
                    </div>
                    <div class="custom-select-option" data-value="trial">
                      Trial
                    </div>
                    <div class="custom-select-option" data-value="expired">
                      Expired
                    </div>
                  </div>
                </div>
                <button
                  class="px-4 py-2 bg-primary text-white rounded-button whitespace-nowrap flex items-center"
                >
                  <i class="ri-add-line mr-2"></i>
                  New Subscription
                </button>
              </div>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="bg-gray-50">
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    User
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Plan
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Status
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Start Date
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    End Date
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Auto Renew
                  </th>
                  <th
                    class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody
                class="divide-y divide-gray-200"
                id="subscriptions-table-body"
              >
                <!-- Filled by JS -->
              </tbody>
            </table>
          </div>
          <div class="px-4 py-3 flex items-center justify-between border-t">
            <div class="flex items-center text-sm text-gray-500">
              <span>Showing</span>
              <div
                class="custom-select mx-2"
                id="subscription-page-size-select"
              >
                <div class="custom-select-trigger">
                  <span>10</span>
                  <i class="ri-arrow-down-s-line ml-1"></i>
                </div>
                <div class="custom-select-options">
                  <div class="custom-select-option" data-value="10">10</div>
                  <div class="custom-select-option" data-value="20">20</div>
                  <div class="custom-select-option" data-value="50">50</div>
                </div>
              </div>
              <span id="subscriptions-total-count">of 45 subscriptions</span>
            </div>
            <div
              class="flex items-center space-x-1"
              id="subscriptions-pagination"
            >
              <button
                class="pagination-item text-gray-500 hover:bg-gray-100"
                id="subscriptions-prev-page"
              >
                <i class="ri-arrow-left-s-line"></i>
              </button>
              <!-- Page numbers will be injected here -->
              <button
                class="pagination-item text-gray-600 hover:bg-gray-100 subscriptions-page-btn"
                data-page="1"
              >
                1
              </button>
              <button
                class="pagination-item text-gray-600 hover:bg-gray-100 subscriptions-page-btn"
                data-page="2"
              >
                2
              </button>
              <button
                class="pagination-item text-gray-600 hover:bg-gray-100 subscriptions-page-btn"
                data-page="3"
              >
                3
              </button>
              <button
                class="pagination-item text-gray-600 hover:bg-gray-100 subscriptions-page-btn"
                data-page="4"
              >
                4
              </button>
              <button
                class="pagination-item text-gray-600 hover:bg-gray-100 subscriptions-page-btn"
                data-page="5"
              >
                5
              </button>
              <button
                class="pagination-item text-gray-500 hover:bg-gray-100"
                id="subscriptions-next-page"
              >
                <i class="ri-arrow-right-s-line"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
    <!-- Modals for Subscriptions -->
    <div id="subscription-history-modal" class="modal">
      <div class="modal-content max-w-2xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium text-gray-800">
            Subscription History
          </h3>
          <button class="modal-close text-gray-400 hover:text-gray-500">
            <i class="ri-close-line ri-lg"></i>
          </button>
        </div>
        <div class="space-y-4">
          <div
            class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"
          >
            <div>
              <p class="text-sm font-medium text-gray-800">Current Plan: Pro</p>
              <p class="text-xs text-gray-500">Active since: Jun 01, 2025</p>
            </div>
            <span
              class="px-2 py-1 text-xs font-medium bg-green-50 text-green-600 rounded-full"
              >Active</span
            >
          </div>
          <div class="space-y-3">
            <div class="border-l-2 border-primary pl-3">
              <p class="text-sm font-medium text-gray-800">
                Plan upgraded to Pro
              </p>
              <p class="text-xs text-gray-500">Jun 01, 2025 • $49.99/month</p>
            </div>
            <div class="border-l-2 border-gray-200 pl-3">
              <p class="text-sm font-medium text-gray-800">
                Payment successful
              </p>
              <p class="text-xs text-gray-500">Jun 01, 2025 • 0.05 ETH</p>
            </div>
            <div class="border-l-2 border-gray-200 pl-3">
              <p class="text-sm font-medium text-gray-800">Trial started</p>
              <p class="text-xs text-gray-500">May 25, 2025 • Basic Plan</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="pause-subscription-modal" class="modal">
      <div class="modal-content">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium text-gray-800">Pause Subscription</h3>
          <button class="modal-close text-gray-400 hover:text-gray-500">
            <i class="ri-close-line ri-lg"></i>
          </button>
        </div>
        <div class="space-y-4">
          <div class="flex items-center">
            <div
              class="w-12 h-12 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center"
            >
              <i class="ri-pause-circle-line ri-lg"></i>
            </div>
            <div class="ml-4">
              <h4 class="text-lg font-medium text-gray-800">
                Are you sure you want to pause this subscription?
              </h4>
              <p class="text-sm text-gray-500">
                The user will lose access to premium features until the
                subscription is resumed.
              </p>
            </div>
          </div>
          <div>
            <label
              for="pause-reason"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Reason for pausing (optional)</label
            >
            <textarea
              id="pause-reason"
              rows="3"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              placeholder="Enter reason for pausing..."
            ></textarea>
          </div>
          <div>
            <label
              for="pause-duration"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Pause Duration</label
            >
            <div class="custom-select" id="pause-duration-select">
              <div class="custom-select-trigger">
                <span>1 month</span>
                <i class="ri-arrow-down-s-line ml-2"></i>
              </div>
              <div class="custom-select-options">
                <div class="custom-select-option" data-value="1week">
                  1 week
                </div>
                <div class="custom-select-option" data-value="2weeks">
                  2 weeks
                </div>
                <div class="custom-select-option" data-value="1month">
                  1 month
                </div>
                <div class="custom-select-option" data-value="3months">
                  3 months
                </div>
              </div>
            </div>
          </div>
          <div class="flex items-center">
            <label class="custom-checkbox">
              <input type="checkbox" checked />
              <span class="checkbox-mark"></span>
            </label>
            <span class="ml-2 text-sm text-gray-600"
              >Send email notification to user</span
            >
          </div>
          <div class="flex items-center justify-end space-x-3 pt-4 border-t">
            <button
              class="px-4 py-2 border border-gray-200 text-gray-600 rounded-button whitespace-nowrap hover:bg-gray-50 modal-close"
            >
              Cancel
            </button>
            <button
              class="px-4 py-2 bg-yellow-600 text-white rounded-button whitespace-nowrap"
            >
              Pause Subscription
            </button>
          </div>
        </div>
      </div>
    </div>
    <div id="cancel-subscription-modal" class="modal">
      <div class="modal-content">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium text-gray-800">Cancel Subscription</h3>
          <button class="modal-close text-gray-400 hover:text-gray-500">
            <i class="ri-close-line ri-lg"></i>
          </button>
        </div>
        <div class="space-y-4">
          <div class="flex items-center">
            <div
              class="w-12 h-12 rounded-full bg-red-100 text-red-600 flex items-center justify-center"
            >
              <i class="ri-close-circle-line ri-lg"></i>
            </div>
            <div class="ml-4">
              <h4 class="text-lg font-medium text-gray-800">
                Are you sure you want to cancel this subscription?
              </h4>
              <p class="text-sm text-gray-500">
                The user will immediately lose access to all premium features.
              </p>
            </div>
          </div>
          <div class="bg-yellow-50 p-4 rounded-lg">
            <div class="flex">
              <div class="flex-shrink-0">
                <i class="ri-error-warning-line text-yellow-600"></i>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-yellow-800">Warning</h3>
                <div class="mt-2 text-sm text-yellow-700">
                  <p>
                    This action cannot be undone. Consider pausing the
                    subscription instead.
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div>
            <label
              for="cancel-reason"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Reason for cancellation (optional)</label
            >
            <textarea
              id="cancel-reason"
              rows="3"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              placeholder="Enter reason for cancellation..."
            ></textarea>
          </div>
          <div class="flex items-center">
            <label class="custom-checkbox">
              <input type="checkbox" checked />
              <span class="checkbox-mark"></span>
            </label>
            <span class="ml-2 text-sm text-gray-600"
              >Send email notification to user</span
            >
          </div>
          <div class="flex items-center justify-end space-x-3 pt-4 border-t">
            <button
              class="px-4 py-2 border border-gray-200 text-gray-600 rounded-button whitespace-nowrap hover:bg-gray-50 modal-close"
            >
              Cancel
            </button>
            <button
              class="px-4 py-2 bg-red-600 text-white rounded-lg button whitespace-nowrap"
            >
              Cancel Subscription
            </button>
          </div>
        </div>
      </div>
    </div>

    <script id="modal-script">
      document.addEventListener("DOMContentLoaded", function () {
        const modals = document.querySelectorAll(".modal");
        const modalCloseButtons = document.querySelectorAll(".modal-close");
        const toast = document.getElementById("toast-success");

        function showToast() {
          toast.classList.remove("translate-x-full");
          setTimeout(() => {
            toast.classList.add("translate-x-full");
          }, 3000);
        }

        // Handle wallet verification
        const verifyWalletButtons = document.querySelectorAll(
          '[data-action="verify"]'
        );
        const verifyWalletModal = document.getElementById(
          "verify-wallet-modal"
        );
        const confirmVerifyWalletBtn = document.getElementById(
          "confirm-verify-wallet"
        );

        verifyWalletButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const row = this.closest("tr");
            const userName = row.querySelector(
              ".text-sm.font-medium.text-gray-800"
            ).textContent;
            const blockchain = row.querySelector(
              ".text-sm.text-gray-600"
            ).textContent;
            const walletAddress = row.querySelector(
              ".text-sm.text-gray-600:nth-child(2)"
            ).textContent;

            document.getElementById("verify-wallet-user").textContent =
              userName;
            document.getElementById("verify-wallet-blockchain").textContent =
              blockchain;
            document.getElementById("verify-wallet-address").textContent =
              walletAddress;

            openModal("verify-wallet-modal");
          });
        });

        if (confirmVerifyWalletBtn) {
          confirmVerifyWalletBtn.addEventListener("click", function () {
            const walletAddress = document.getElementById(
              "verify-wallet-address"
            ).textContent;
            const statusElements = document.querySelectorAll(
              "td:nth-child(6) span"
            );

            statusElements.forEach((element) => {
              if (
                element
                  .closest("tr")
                  .querySelector(".text-sm.text-gray-600:nth-child(2)")
                  .textContent === walletAddress
              ) {
                element.className =
                  "px-2 py-1 text-xs font-medium bg-green-50 text-green-600 rounded-full";
                element.textContent = "Valid";
              }
            });

            closeModal(verifyWalletModal);
            showToast();
          });
        }
        // Add tooltip container to body
        const tooltip = document.createElement("div");
        tooltip.className =
          "fixed px-2 py-1 text-xs text-white bg-gray-900 rounded pointer-events-none opacity-0 transition-opacity duration-200 z-50";
        document.body.appendChild(tooltip);
        const logoutBtn = document.getElementById("logout-btn");
        const logoutModal = document.getElementById("logout-modal");
        const cancelLogoutBtn = document.getElementById("cancel-logout");
        const confirmLogoutBtn = document.getElementById("confirm-logout");
        // Handle logout flow
        if (logoutBtn) {
          logoutBtn.addEventListener("click", function () {
            openModal("logout-modal");
          });
        }
        if (cancelLogoutBtn) {
          cancelLogoutBtn.addEventListener("click", function () {
            closeModal(logoutModal);
          });
        }
        if (confirmLogoutBtn) {
          confirmLogoutBtn.addEventListener("click", function () {
            // Clear any session data here
            window.location.href = "/login"; // Redirect to login page
          });
        }
        // Action buttons for user actions
        const viewUserButtons = document.querySelectorAll(
          '[data-action="view"]'
        );
        const deleteUserButtons = document.querySelectorAll(
          '[data-action="delete"]'
        );
        const suspendUserButtons = document.querySelectorAll(
          '[data-action="suspend"]'
        );
        function openModal(modalId) {
          const modal = document.getElementById(modalId);
          if (modal) {
            modal.classList.add("active");
            document.body.style.overflow = "hidden";
          }
        }
        function closeModal(modal) {
          modal.classList.remove("active");
          document.body.style.overflow = "";
        }
        // Close modal when clicking close button
        modalCloseButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const modal = this.closest(".modal");
            closeModal(modal);
          });
        });
        // Close modal when clicking outside the modal content
        modals.forEach((modal) => {
          modal.addEventListener("click", function (e) {
            if (e.target === this) {
              closeModal(this);
            }
          });
        });
        // Open user action modals
        viewUserButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-user-id");
            openModal("view-user-modal");
          });
        });
        // Handle subscription action buttons
        const subscriptionButtons = document.querySelectorAll(
          ".subscription-action"
        );
        subscriptionButtons.forEach((button) => {
          // Tooltip handling
          button.addEventListener("mouseenter", function (e) {
            const tooltipText = this.getAttribute("data-tooltip");
            tooltip.textContent = tooltipText;
            tooltip.style.opacity = "1";
            // Position tooltip above the button
            const rect = this.getBoundingClientRect();
            tooltip.style.top = rect.top - 30 + "px";
            tooltip.style.left =
              rect.left + rect.width / 2 - tooltip.offsetWidth / 2 + "px";
          });
          button.addEventListener("mouseleave", function () {
            tooltip.style.opacity = "0";
          });
          // Modal handling
          button.addEventListener("click", function () {
            const action = this.getAttribute("data-action");
            switch (action) {
              case "history":
                openModal("subscription-history-modal");
                break;
              case "pause":
                openModal("pause-subscription-modal");
                break;
              case "cancel":
                openModal("cancel-subscription-modal");
                break;
            }
          });
        });
        deleteUserButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-user-id");
            openModal("delete-user-modal");
          });
        });
        suspendUserButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-user-id");
            openModal("suspend-user-modal");
          });
        });
      });
    </script>
    <script id="charts-script">
      document.addEventListener("DOMContentLoaded", function () {
        // Subscription Chart
        if (document.getElementById("subscription-chart")) {
          const subscriptionChart = echarts.init(
            document.getElementById("subscription-chart")
          );
          const subscriptionOption = {
            animation: false,
            tooltip: {
              trigger: "axis",
              backgroundColor: "rgba(255, 255, 255, 0.8)",
              borderColor: "#e2e8f0",
              textStyle: {
                color: "#1f2937",
              },
            },
            legend: {
              data: ["Basic", "Pro", "Enterprise"],
              bottom: 0,
              textStyle: {
                color: "#1f2937",
              },
            },
            grid: {
              left: 0,
              right: 0,
              top: 10,
              bottom: 30,
              containLabel: true,
            },
            xAxis: {
              type: "category",
              boundaryGap: false,
              data: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
              axisLine: {
                lineStyle: {
                  color: "#e2e8f0",
                },
              },
              axisLabel: {
                color: "#1f2937",
              },
            },
            yAxis: {
              type: "value",
              axisLine: {
                show: false,
              },
              axisLabel: {
                color: "#1f2937",
              },
              splitLine: {
                lineStyle: {
                  color: "#e2e8f0",
                },
              },
            },
            series: [
              {
                name: "Basic",
                type: "line",
                stack: "Total",
                smooth: true,
                symbol: "none",
                lineStyle: {
                  width: 3,
                },
                areaStyle: {
                  opacity: 0.1,
                },
                emphasis: {
                  focus: "series",
                },
                color: "rgba(141, 211, 199, 1)",
                data: [120, 132, 101, 134, 90, 230],
              },
              {
                name: "Pro",
                type: "line",
                stack: "Total",
                smooth: true,
                symbol: "none",
                lineStyle: {
                  width: 3,
                },
                areaStyle: {
                  opacity: 0.1,
                },
                emphasis: {
                  focus: "series",
                },
                color: "rgba(87, 181, 231, 1)",
                data: [220, 182, 191, 234, 290, 330],
              },
              {
                name: "Enterprise",
                type: "line",
                stack: "Total",
                smooth: true,
                symbol: "none",
                lineStyle: {
                  width: 3,
                },
                areaStyle: {
                  opacity: 0.1,
                },
                emphasis: {
                  focus: "series",
                },
                color: "rgba(252, 141, 98, 1)",
                data: [150, 232, 201, 154, 190, 330],
              },
            ],
          };
          subscriptionChart.setOption(subscriptionOption);
          window.addEventListener("resize", function () {
            subscriptionChart.resize();
          });
        }
        // Plan Distribution Chart
        if (document.getElementById("plan-distribution-chart")) {
          const planDistributionChart = echarts.init(
            document.getElementById("plan-distribution-chart")
          );
          const planDistributionOption = {
            animation: false,
            tooltip: {
              trigger: "item",
              backgroundColor: "rgba(255, 255, 255, 0.8)",
              borderColor: "#e2e8f0",
              textStyle: {
                color: "#1f2937",
              },
            },
            legend: {
              orient: "vertical",
              right: 10,
              top: "center",
              textStyle: {
                color: "#1f2937",
              },
            },
            series: [
              {
                name: "Plan Distribution",
                type: "pie",
                radius: ["40%", "70%"],
                center: ["40%", "50%"],
                avoidLabelOverlap: false,
                itemStyle: {
                  borderRadius: 8,
                  borderColor: "#fff",
                  borderWidth: 2,
                },
                label: {
                  show: false,
                },
                emphasis: {
                  label: {
                    show: false,
                  },
                },
                labelLine: {
                  show: false,
                },
                data: [
                  {
                    value: 485,
                    name: "Basic",
                    itemStyle: { color: "rgba(141, 211, 199, 1)" },
                  },
                  {
                    value: 300,
                    name: "Pro",
                    itemStyle: { color: "rgba(87, 181, 231, 1)" },
                  },
                  {
                    value: 91,
                    name: "Enterprise",
                    itemStyle: { color: "rgba(252, 141, 98, 1)" },
                  },
                ],
              },
            ],
          };
          planDistributionChart.setOption(planDistributionOption);
          window.addEventListener("resize", function () {
            planDistributionChart.resize();
          });
        }
      });
    </script>
    <script>
      (function () {
        // Mock subscription data
        const subscriptionUsers = [
          {
            initials: "EB",
            name: "Emma Brown",
            email: "emma.brown@example.com",
            plan: "Pro",
            planColor: "bg-blue-50 text-primary",
            status: "Active",
            statusColor: "bg-green-50 text-green-600",
            start: "Jun 01, 2025",
            end: "Jul 01, 2025",
            autoRenew: true,
          },
          {
            initials: "RJ",
            name: "Robert Johnson",
            email: "robert.j@example.com",
            plan: "Enterprise",
            planColor: "bg-purple-50 text-purple-600",
            status: "Active",
            statusColor: "bg-green-50 text-green-600",
            start: "May 15, 2025",
            end: "Aug 15, 2025",
            autoRenew: true,
          },
          {
            initials: "SW",
            name: "Sarah Wilson",
            email: "sarah.w@example.com",
            plan: "Basic",
            planColor: "bg-gray-100 text-gray-600",
            status: "Trial",
            statusColor: "bg-yellow-50 text-yellow-600",
            start: "Jun 20, 2025",
            end: "Jun 27, 2025",
            autoRenew: false,
          },
          {
            initials: "DM",
            name: "David Miller",
            email: "david.m@example.com",
            plan: "Pro",
            planColor: "bg-blue-50 text-primary",
            status: "Expired",
            statusColor: "bg-red-50 text-red-600",
            start: "May 01, 2025",
            end: "Jun 01, 2025",
            autoRenew: false,
          },
          {
            initials: "JT",
            name: "Jessica Thompson",
            email: "jessica.t@example.com",
            plan: "Basic",
            planColor: "bg-gray-100 text-gray-600",
            status: "Active",
            statusColor: "bg-green-50 text-green-600",
            start: "Jun 10, 2025",
            end: "Jul 10, 2025",
            autoRenew: true,
          },
        ];

        // Generate more mock data for demo
        const plans = [
          { name: "Basic", color: "bg-gray-100 text-gray-600" },
          { name: "Pro", color: "bg-blue-50 text-primary" },
          { name: "Enterprise", color: "bg-purple-50 text-purple-600" },
        ];
        const statuses = [
          { name: "Active", color: "bg-green-50 text-green-600" },
          { name: "Trial", color: "bg-yellow-50 text-yellow-600" },
          { name: "Expired", color: "bg-red-50 text-red-600" },
        ];
        const names = [
          "Ava Lee",
          "Benjamin Clark",
          "Mia Lewis",
          "Lucas Walker",
          "Charlotte Hall",
          "Henry Allen",
          "Amelia Young",
          "Jack King",
          "Emily Wright",
          "Alexander Scott",
          "Ella Green",
          "Daniel Adams",
          "Grace Baker",
          "Matthew Nelson",
          "Chloe Carter",
          "Sebastian Mitchell",
          "Harper Perez",
          "Jackson Roberts",
          "Lily Turner",
          "Logan Phillips",
          "Zoe Campbell",
          "Mason Parker",
          "Layla Evans",
          "Elijah Edwards",
          "Scarlett Collins",
          "Aiden Stewart",
          "Penelope Sanchez",
          "Carter Morris",
          "Riley Rogers",
          "Wyatt Reed",
          "Victoria Cook",
          "Julian Morgan",
          "Hannah Bell",
          "Levi Murphy",
          "Aria Bailey",
          "Gabriel Rivera",
          "Nora Cooper",
          "Lincoln Richardson",
          "Sofia Cox",
          "Samuel Howard",
        ];
        for (let i = 0; i < 40; i++) {
          const planIdx = Math.floor(Math.random() * plans.length);
          const statusIdx = Math.floor(Math.random() * statuses.length);
          const initials = names[i]
            .split(" ")
            .map((n) => n[0])
            .join("");
          const startDate = new Date(
            2025,
            Math.floor(Math.random() * 6),
            1 + Math.floor(Math.random() * 28)
          );
          const endDate = new Date(startDate);
          endDate.setMonth(endDate.getMonth() + 1);
          subscriptionUsers.push({
            initials,
            name: names[i],
            email: names[i].toLowerCase().replace(/ /g, ".") + "@example.com",
            plan: plans[planIdx].name,
            planColor: plans[planIdx].color,
            status: statuses[statusIdx].name,
            statusColor: statuses[statusIdx].color,
            start: startDate.toLocaleDateString("en-US", {
              month: "short",
              day: "2-digit",
              year: "numeric",
            }),
            end: endDate.toLocaleDateString("en-US", {
              month: "short",
              day: "2-digit",
              year: "numeric",
            }),
            autoRenew: Math.random() > 0.3,
          });
        }

        // State
        let filteredSubs = [...subscriptionUsers];
        let subsCurrentPage = 1;
        let subsPageSize = 10;
        let subsPlanFilter = "all";
        let subsStatusFilter = "all";

        // DOM
        const subsTbody = document.getElementById("subscriptions-table-body");
        const subsPageSizeSelect = document.getElementById(
          "subscription-page-size-select"
        );
        const subsPlanFilterSelect = document.getElementById(
          "subscription-plan-filter"
        );
        const subsStatusFilterSelect = document.getElementById(
          "subscription-status-filter"
        );
        const subsPagination = document.getElementById(
          "subscriptions-pagination"
        );
        const subsPrevBtn = document.getElementById("subscriptions-prev-page");
        const subsNextBtn = document.getElementById("subscriptions-next-page");
        const subsTotalCount = document.getElementById(
          "subscriptions-total-count"
        );

        // --- Custom Select Patch for Filters ---
        // Listen for custom-select changes and dispatch "change" event for vanilla JS
        function patchCustomSelect(select) {
          const trigger = select.querySelector(".custom-select-trigger");
          const options = select.querySelectorAll(".custom-select-option");
          trigger &&
            trigger.addEventListener("click", function (e) {
              e.stopPropagation();
              document
                .querySelectorAll("#subscriptions-tab .custom-select")
                .forEach((other) => {
                  if (other !== select) other.classList.remove("open");
                });
              select.classList.toggle("open");
            });
          options.forEach((option) => {
            option.addEventListener("click", function () {
              const value = this.getAttribute("data-value");
              select.setAttribute("data-value", value);
              select.classList.remove("open");
              // Update trigger text
              const triggerSpan = trigger.querySelector("span");
              if (triggerSpan)
                triggerSpan.textContent = this.textContent.trim();
              // Dispatch change event
              const event = new CustomEvent("change", { detail: { value } });
              select.dispatchEvent(event);
            });
          });
        }
        // Patch all custom selects in filter area and page size
        document
          .querySelectorAll("#subscriptions-tab .custom-select")
          .forEach(patchCustomSelect);
        // Close selects when clicking outside
        document.addEventListener("click", function () {
          document
            .querySelectorAll("#subscriptions-tab .custom-select")
            .forEach((select) => select.classList.remove("open"));
        });

        function renderSubsTable() {
          // Filter
          filteredSubs = subscriptionUsers.filter((u) => {
            let matchesPlan =
              subsPlanFilter === "all" ||
              u.plan.toLowerCase() === subsPlanFilter;
            let matchesStatus =
              subsStatusFilter === "all" ||
              u.status.toLowerCase() === subsStatusFilter;
            return matchesPlan && matchesStatus;
          });
          // Pagination
          const total = filteredSubs.length;
          const totalPages = Math.max(1, Math.ceil(total / subsPageSize));
          if (subsCurrentPage > totalPages) subsCurrentPage = totalPages;
          const start = (subsCurrentPage - 1) * subsPageSize;
          const end = Math.min(start + subsPageSize, total);
          const subsToShow = filteredSubs.slice(start, end);

          // Table rows
          subsTbody.innerHTML = subsToShow
            .map(
              (user) => `
        <tr>
            <td class="px-4 py-3 whitespace-nowrap">
            <div class="flex items-center">
            <div class="w-8 h-8 rounded-full ${
              user.plan === "Pro"
                ? "bg-blue-100 text-primary"
                : user.plan === "Enterprise"
                ? "bg-purple-100 text-purple-600"
                : user.plan === "Basic"
                ? "bg-orange-100 text-orange-600"
                : "bg-gray-100 text-gray-600"
            } flex items-center justify-center">
                <span class="text-sm font-medium">${user.initials}</span>
            </div>
            <div class="ml-3">
                <p class="text-sm font-medium text-gray-800">${user.name}</p>
                <p class="text-xs text-gray-500">${user.email}</p>
            </div>
            </div>
            </td>
            <td class="px-4 py-3 whitespace-nowrap">
            <div class="custom-select subscription-plan-select">
            <div class="custom-select-trigger">
                <span class="px-2 py-1 text-xs font-medium ${
                  user.planColor
                } rounded-full">${user.plan}</span>
                <i class="ri-arrow-down-s-line ml-2"></i>
            </div>
            <div class="custom-select-options">
                <div class="custom-select-option" data-value="basic">
                <span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-full">Basic</span>
                </div>
                <div class="custom-select-option" data-value="pro">
                <span class="px-2 py-1 text-xs font-medium bg-blue-50 text-primary rounded-full">Pro</span>
                </div>
                <div class="custom-select-option" data-value="enterprise">
                <span class="px-2 py-1 text-xs font-medium bg-purple-50 text-purple-600 rounded-full">Enterprise</span>
                </div>
            </div>
            </div>
            </td>
            <td class="px-4 py-3 whitespace-nowrap">
            <span class="px-2 py-1 text-xs font-medium ${
              user.statusColor
            } rounded-full">${user.status}</span>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">${
              user.start
            }</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">${
              user.end
            }</td>
            <td class="px-4 py-3 whitespace-nowrap">
            <label class="custom-switch">
            <input type="checkbox" ${user.autoRenew ? "checked" : ""}>
            <span class="switch-slider"></span>
            </label>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-right text-sm font-medium">
            <div class="flex items-center justify-end space-x-2">
            <button class="w-8 h-8 flex items-center justify-center text-gray-500 hover:text-primary rounded-full hover:bg-blue-50 subscription-action" data-action="history" data-tooltip="View subscription history">
                <i class="ri-history-line"></i>
            </button>
            <button class="w-8 h-8 flex items-center justify-center text-gray-500 hover:text-yellow-500 rounded-full hover:bg-yellow-50 subscription-action" data-action="pause" data-tooltip="Pause subscription">
                <i class="ri-pause-circle-line"></i>
            </button>
            <button class="w-8 h-8 flex items-center justify-center text-gray-500 hover:text-red-500 rounded-full hover:bg-red-50 subscription-action" data-action="cancel" data-tooltip="Cancel subscription">
                <i class="ri-close-circle-line"></i>
            </button>
            </div>
            </td>
        </tr>
        `
            )
            .join("");

          // Pagination info
          subsTotalCount.textContent = `of ${total} subscriptions`;

          // Pagination buttons
          renderSubsPagination(totalPages);

          // Patch custom selects in table
          setTimeout(() => {
            document
              .querySelectorAll("#subscriptions-table-body .custom-select")
              .forEach((select) => {
                const trigger = select.querySelector(".custom-select-trigger");
                const options = select.querySelector(".custom-select-options");
                const optionItems = select.querySelectorAll(
                  ".custom-select-option"
                );
                trigger.onclick = function (e) {
                  e.stopPropagation();
                  document
                    .querySelectorAll(".custom-select")
                    .forEach((other) => {
                      if (other !== select) other.classList.remove("open");
                    });
                  select.classList.toggle("open");
                };
                optionItems.forEach((option) => {
                  option.onclick = function () {
                    const value = this.getAttribute("data-value");
                    const optionHtml = this.innerHTML;
                    trigger.querySelector("span").outerHTML = optionHtml;
                    select.setAttribute("data-value", value);
                    select.classList.remove("open");
                    // Optionally update user plan in data
                  };
                });
              });

            // Re-attach modal event listeners for subscription action buttons
            document
              .querySelectorAll(
                "#subscriptions-table-body .subscription-action"
              )
              .forEach((button) => {
                button.onclick = function () {
                  const action = this.getAttribute("data-action");
                  switch (action) {
                    case "history":
                      document
                        .getElementById("subscription-history-modal")
                        .classList.add("active");
                      document.body.style.overflow = "hidden";
                      break;
                    case "pause":
                      document
                        .getElementById("pause-subscription-modal")
                        .classList.add("active");
                      document.body.style.overflow = "hidden";
                      break;
                    case "cancel":
                      document
                        .getElementById("cancel-subscription-modal")
                        .classList.add("active");
                      document.body.style.overflow = "hidden";
                      break;
                  }
                };
                // Tooltip handling (optional, if you want to keep tooltips)
                button.onmouseenter = function (e) {
                  const tooltip = document.querySelector("body > .fixed.px-2");
                  if (tooltip) {
                    tooltip.textContent = this.getAttribute("data-tooltip");
                    tooltip.style.opacity = "1";
                    const rect = this.getBoundingClientRect();
                    tooltip.style.top = rect.top - 30 + "px";
                    tooltip.style.left =
                      rect.left +
                      rect.width / 2 -
                      tooltip.offsetWidth / 2 +
                      "px";
                  }
                };
                button.onmouseleave = function () {
                  const tooltip = document.querySelector("body > .fixed.px-2");
                  if (tooltip) tooltip.style.opacity = "0";
                };
              });
          }, 0);
        }

        function renderSubsPagination(totalPages) {
          // Remove old page buttons
          subsPagination
            .querySelectorAll(".subscriptions-page-btn")
            .forEach((btn) => btn.remove());
          // Insert new page buttons
          for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement("button");
            btn.className =
              "pagination-item text-gray-600 hover:bg-gray-100 subscriptions-page-btn";
            btn.textContent = i;
            btn.setAttribute("data-page", i);
            if (i === subsCurrentPage)
              btn.classList.add("active", "bg-blue-50", "text-primary");
            btn.onclick = function () {
              subsCurrentPage = i;
              renderSubsTable();
            };
            subsPagination.insertBefore(btn, subsNextBtn);
          }
          // Prev/next
          subsPrevBtn.disabled = subsCurrentPage === 1;
          subsNextBtn.disabled = subsCurrentPage === totalPages;
          subsPrevBtn.classList.toggle("opacity-50", subsPrevBtn.disabled);
          subsPrevBtn.classList.toggle(
            "cursor-not-allowed",
            subsPrevBtn.disabled
          );
          subsNextBtn.classList.toggle("opacity-50", subsNextBtn.disabled);
          subsNextBtn.classList.toggle(
            "cursor-not-allowed",
            subsNextBtn.disabled
          );
        }

        // Event listeners
        subsPrevBtn.onclick = function () {
          if (subsCurrentPage > 1) {
            subsCurrentPage--;
            renderSubsTable();
          }
        };
        subsNextBtn.onclick = function () {
          const total = filteredSubs.length;
          const totalPages = Math.max(1, Math.ceil(total / subsPageSize));
          if (subsCurrentPage < totalPages) {
            subsCurrentPage++;
            renderSubsTable();
          }
        };
        // Page size select
        subsPageSizeSelect.addEventListener("change", function (e) {
          const value = subsPageSizeSelect.getAttribute("data-value");
          if (value) {
            subsPageSize = parseInt(value, 10);
            subsCurrentPage = 1;
            renderSubsTable();
          }
        });
        // Plan filter
        subsPlanFilterSelect.addEventListener("change", function (e) {
          subsPlanFilter =
            subsPlanFilterSelect.getAttribute("data-value") || "all";
          subsCurrentPage = 1;
          renderSubsTable();
        });
        // Status filter
        subsStatusFilterSelect.addEventListener("change", function (e) {
          subsStatusFilter =
            subsStatusFilterSelect.getAttribute("data-value") || "all";
          subsCurrentPage = 1;
          renderSubsTable();
        });

        // Initial render
        renderSubsTable();
      })();
    </script>
  </body>
</html>
